<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TRIC Form - Digital</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Digital TRIC Form for K-Electric CHSEQ - Tool Box Talk Risk Identification Card">
    <meta name="theme-color" content="#F7941E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TRIC Form">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="72x72" href="icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72x72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-72x72.png">
    <style>
        :root {
            --color-primary: #F7941E;
            --color-primary-dark: #E8851B;
            --color-bg: #FFFFFF;
            --color-text: #333333;
            --color-text-light: #666666;
            --color-success: #10B981;
            --color-success-dark: #059669;
            --color-border: #E0E0E0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* Safe area support for notched devices */
        @supports (padding-top: env(safe-area-inset-top)) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--color-bg);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Mobile Native App Experience */
        @media (max-width: 768px) {
            body {
                padding: 0;
                margin: 0;
                height: 100vh;
                overflow: hidden;
            }
        }

        .container {
            width: 100%;
            max-width: 500px;
        }

        @media (max-width: 768px) {
            .container {
                max-width: 100%;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }
        }

        .card {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            min-height: 600px;
        }

        @media (max-width: 768px) {
            .card {
                border-radius: 0;
                box-shadow: none;
                border: none;
                height: 100%;
                display: flex;
                flex-direction: column;
                min-height: 100vh;
            }
        }

        .header {
            background-color: var(--color-primary);
            padding: 24px 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .header {
                padding: 16px 20px;
            }
        }

        .badge-text {
            color: #FFFFFF;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .title {
            font-size: 48px;
            font-weight: 800;
            color: #FFFFFF;
            margin-bottom: 12px;
            letter-spacing: -1px;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 36px;
                margin-bottom: 8px;
            }
        }

        .tagline {
            background-color: rgba(255, 255, 255, 0.15);
            display: inline-block;
            padding: 12px 24px;
            border-radius: 8px;
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 600;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .tagline {
                padding: 8px 16px;
                font-size: 12px;
            }
        }

        .content {
            padding: 80px 34px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .content {
                padding: 32px 24px;
                flex: 1;
                overflow-y: auto;
            }
        }

        .welcome-box {
            background: linear-gradient(135deg, #FFF8F0 0%, #FFE4CC 100%);
            border-radius: 24px;
            padding: 48px;
            text-align: center;
            margin-bottom: 48px;
            border: 1px solid #FFD4A3;
        }

        @media (max-width: 768px) {
            .welcome-box {
                padding: 24px 20px;
                margin-bottom: 24px;
                border-radius: 16px;
            }
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 12px;
        }

        @media (max-width: 768px) {
            .welcome-title {
                font-size: 24px;
                margin-bottom: 8px;
            }
        }

        .welcome-text {
            color: var(--color-text-light);
            font-size: 14px;
            line-height: 1.6;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-start {
            background-color: var(--color-success);
            color: #FFFFFF;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            margin-bottom: 24px;
        }

        .btn-start:hover {
            background-color: var(--color-success-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        .urdu-section {
            text-align: center;
            padding: 16px 0;
            border-top: 1px solid var(--color-border);
            border-bottom: 1px solid var(--color-border);
            margin-bottom: 24px;
        }

        .urdu-text {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: var(--color-success);
            font-size: 17px;
            font-weight: 700;
            line-height: 1.8;
        }

        .btn-saved {
            background-color: #F9FAFB;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-saved:hover {
            background-color: #FFF8F0;
            transform: translateY(-2px);
        }

        .saved-info {
            text-align: center;
            color: var(--color-text-light);
            font-size: 12px;
            margin-top: 8px;
        }

        .footer {
            background-color: #F9FAFB;
            padding: 16px;
            text-align: center;
            border-top: 1px solid var(--color-border);
            flex-shrink: 0;
        }

        .footer-text {
            color: var(--color-text-light);
            font-size: 12px;
            font-weight: 600;
        }

        /* Page System */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* PAGE 2 STYLES */
        .page2-container {
            background-color: var(--color-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .page2-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                box-shadow: none;
            }
        }

        .page2-header {
            text-align: center;
            padding: 20px;
            background-color: var(--color-primary);
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .page2-header {
                padding: 12px 16px;
                border-radius: 0;
            }
        }

        .page2-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-bg);
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .page2-header h1 {
                font-size: 20px;
                margin-bottom: 4px;
            }
        }

        .page2-header p {
            color: var(--color-bg);
            font-size: 14px;
            opacity: 0.95;
        }

        @media (max-width: 768px) {
            .page2-header p {
                font-size: 12px;
            }
        }

        .form-content {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
            background-color: #F5F5F5;
        }

        @media (max-width: 768px) {
            .form-content {
                padding: 16px 12px;
                padding-bottom: 20px;
            }
        }

        .form-content::-webkit-scrollbar {
            width: 8px;
        }

        .form-content::-webkit-scrollbar-track {
            background: #F5F5F5;
            border-radius: 4px;
        }

        .form-content::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 4px;
        }

        .form-content::-webkit-scrollbar-thumb:hover {
            background: var(--color-text-light);
        }

        .info-section {
            background-color: #FFF8F0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid #FFE4CC;
        }

        @media (max-width: 768px) {
            .info-section {
                padding: 12px;
                margin-bottom: 16px;
                border-radius: 6px;
            }
        }

        .info-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .info-item label {
            color: var(--color-text-light);
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 8px;
            display: block;
        }

        .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 12px;
            color: var(--color-text-light);
            margin-left: 6px;
        }

        .info-value {
            width: 100%;
            padding: 10px 12px;
            border-radius: 6px;
            background-color: var(--color-bg);
            color: var(--color-text);
            font-weight: 500;
            border: 1px solid var(--color-border);
        }

        .section {
            background-color: var(--color-bg);
            border-radius: 8px;
            margin-bottom: 24px;
            border: 1px solid var(--color-border);
            overflow: hidden;
        }

        .section-header {
            background-color: var(--color-primary);
            padding: 16px 20px;
        }

        .section-header h2 {
            color: var(--color-bg);
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .section-header .urdu {
            color: var(--color-bg);
            opacity: 0.95;
        }

        .section-body {
            padding: 20px;
            background-color: #FFFFFF;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            color: var(--color-text-light);
            font-weight: 500;
            font-size: 13px;
            margin-bottom: 6px;
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid #D1D5DB;
            background-color: var(--color-bg);
            outline: none;
            font-size: 14px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .form-input:focus {
            border-color: var(--color-primary);
        }

        .form-input.error {
            border: 2px solid #EF4444;
            background-color: #FEF2F2;
        }

        .form-input:disabled {
            background-color: #F3F4F6;
            cursor: not-allowed;
            opacity: 0.6;
        }

        textarea.form-input {
            resize: none;
        }

        .error-message {
            color: #EF4444;
            font-size: 12px;
            margin-top: 4px;
            font-weight: 500;
        }

        .choice-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--color-border);
        }

        .choice-section.error {
            background-color: #FEF2F2;
            padding: 16px;
            border-radius: 6px;
            border: 2px solid #EF4444;
        }

        .choice-section label {
            color: var(--color-text-light);
            font-weight: 500;
            font-size: 13px;
            margin-bottom: 12px;
            display: block;
        }

        .choice-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .choice-btn {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            background-color: var(--color-bg);
            color: var(--color-text);
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .choice-btn:hover {
            border-color: var(--color-primary);
            background-color: #FFF8F0;
        }

        .choice-btn.active-yes {
            background-color: var(--color-success);
            border-color: var(--color-success);
            color: var(--color-bg);
        }

        .choice-btn.active-no {
            background-color: #EF4444;
            border-color: #EF4444;
            color: var(--color-bg);
        }

        .page-footer {
            display: flex;
            gap: 12px;
            padding: 20px 24px;
            background-color: var(--color-bg);
            border-top: 1px solid var(--color-border);
            flex-shrink: 0;
            position: relative;
            z-index: 10;
        }

        @media (max-width: 768px) {
            .page-footer {
                padding: 12px 16px;
                gap: 8px;
                position: sticky;
                bottom: 0;
                background-color: #FFFFFF;
                box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
            }
        }

        .btn-back {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #9CA3AF;
            background-color: var(--color-bg);
            color: #9CA3AF;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
            position: relative;
            z-index: 20;
            min-height: 44px;
        }

        @media (max-width: 768px) {
            .btn-back {
                min-height: 48px;
                touch-action: manipulation;
            }
        }

        .btn-back:hover {
            background-color: #9CA3AF;
            color: var(--color-bg);
        }

        .btn-next {
            flex: 1;
            padding: 14px 20px;
            border: none;
            background-color: var(--color-primary);
            color: var(--color-bg);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
            position: relative;
            z-index: 20;
            min-height: 44px;
        }

        @media (max-width: 768px) {
            .btn-next {
                min-height: 48px;
                touch-action: manipulation;
            }
        }

        .btn-next:hover {
            background-color: var(--color-primary-dark);
            transform: translateY(-2px);
        }

        /* PAGE 3 & PAGE 4 COMMON STYLES */
        .page3-container, .page4-container {
            background-color: var(--color-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .page3-container, .page4-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                box-shadow: none;
            }
        }

        .page3-container {
            max-width: 900px;
            background-color: #FFFFFF;
        }

        .page4-container {
            max-width: 600px;
        }

        .page3-header, .page4-header {
            text-align: center;
            padding: 24px;
            background-color: var(--color-primary);
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .page3-header, .page4-header {
                padding: 12px 16px;
                border-radius: 0;
            }
        }

        .page3-header h1, .page4-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
        }

        .page4-header h1 {
            font-size: 22px;
        }

        .page3-header .urdu, .page4-header .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 16px;
            color: #FFFFFF;
        }

        /* Page 3: White background form content */
        #page3 .form-content {
            background-color: #FFFFFF;
        }

        #page3 .section {
            background-color: #FFFFFF;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--color-border);
            padding: 20px;
        }

        #page3 .section.error {
            border: 2px solid #EF4444;
            background-color: #FEF2F2;
        }

        .label-urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 11px;
            color: var(--color-text-light);
            margin-left: 6px;
        }

        /* Page 3 Specific Styles */
        .member-card {
            position: relative;
            background-color: #FAFAFA;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--color-border);
            margin-bottom: 12px;
        }

        .remove-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #EF4444;
            color: var(--color-bg);
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
            font-size: 20px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            background-color: #DC2626;
            transform: scale(1.1);
        }

        .add-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            color: var(--color-bg);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(247, 148, 30, 0.3);
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(247, 148, 30, 0.4);
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title-urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 13px;
            color: var(--color-text-light);
            margin-bottom: 16px;
        }

        /* Page 4 Specific Styles */
        .error-banner {
            background-color: #FEF2F2;
            border: 2px solid #EF4444;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            display: none;
        }

        .error-banner.show {
            display: block;
        }

        .error-banner p {
            color: #EF4444;
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .tool-card {
            position: relative;
            background-color: var(--color-bg);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #FFE4CC;
            transition: all 0.2s;
        }

        .tool-card.error {
            border: 2px solid #EF4444;
            background-color: #FEF2F2;
        }

        .tool-card.removable .remove-btn {
            display: flex;
        }

        .tool-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .tool-name-urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 11px;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 12px;
        }

        .tool-error {
            color: #EF4444;
            font-size: 10px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 8px;
        }

        .tool-buttons {
            display: flex;
            gap: 4px;
        }

        .tool-btn {
            flex: 1;
            padding: 8px 4px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            background-color: var(--color-bg);
            color: var(--color-text-light);
            border: 1px solid #D1D5DB;
        }

        .tool-btn.active-available {
            background-color: var(--color-success);
            color: var(--color-bg);
            border-color: var(--color-success);
        }

        .tool-btn.active-not-available {
            background-color: #EF4444;
            color: var(--color-bg);
            border-color: #EF4444;
        }

        .tool-btn.active-na {
            background-color: #6B7280;
            color: var(--color-bg);
            border-color: #6B7280;
        }

        .tool-btn svg {
            width: 14px;
            height: 14px;
            margin: 0 auto;
            display: block;
        }

        .add-tool-section {
            margin-top: 16px;
        }

        /* PAGE 10 SPECIFIC STYLES - PQC Rating */
        .page10-container {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
        }

        .page10-header {
            text-align: center;
            padding: 24px 16px;
            background: linear-gradient(135deg, #FB923C 0%, #F97316 100%);
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            flex-shrink: 0;
        }

        .page10-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
        }

        .page10-header p {
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        #page10 .form-content {
            background-color: #FFFFFF;
            padding: 32px 24px;
            overflow-y: auto;
            flex: 1;
        }

        .pqc-disabled-notice {
            text-align: center;
            padding: 32px;
            background-color: #F3F4F6;
            border: 2px solid #D1D5DB;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .pqc-disabled-notice p {
            color: var(--color-text);
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .pqc-disabled-notice .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: var(--color-text-light);
            font-size: 12px;
        }

        .pqc-rating-card {
            background: linear-gradient(135deg, #FFF8F0 0%, #FFFFFF 100%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid #FFE4CC;
            margin-bottom: 24px;
            transition: all 0.3s;
        }

        .pqc-rating-card.error {
            border-color: #EF4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        }

        .pqc-question {
            margin-bottom: 24px;
            text-align: center;
        }

        .pqc-question .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: #EA580C;
            font-weight: 700;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .pqc-question .english {
            color: var(--color-text);
            font-weight: 600;
            font-size: 14px;
            line-height: 1.5;
        }

        .pqc-question .error-text {
            color: #EF4444;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .rating-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .rating-btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 2px solid #FFE4CC;
            background-color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .rating-btn:hover {
            border-color: #FB923C;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .rating-btn.error {
            border-color: #FCA5A5;
        }

        .rating-btn.error:hover {
            border-color: #EF4444;
        }

        .rating-btn.selected {
            transform: scale(1.02);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .rating-btn.selected.good {
            background-color: #22C55E;
            border-color: #16A34A;
        }

        .rating-btn.selected.satisfactory {
            background-color: #EAB308;
            border-color: #CA8A04;
        }

        .rating-btn.selected.needs_improvement {
            background-color: #EF4444;
            border-color: #DC2626;
        }

        .rating-btn-text {
            flex: 1;
            text-align: left;
            font-weight: 700;
            font-size: 14px;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: var(--color-text);
        }

        .rating-btn.selected .rating-btn-text {
            color: #FFFFFF;
        }

        .rating-checkbox {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 2px solid #D1D5DB;
            background-color: #F9FAFB;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .rating-btn.selected .rating-checkbox {
            background-color: #FFFFFF;
            border-color: #FFFFFF;
        }

        .rating-checkbox svg {
            width: 20px;
            height: 20px;
            display: none;
        }

        .rating-btn.selected.good .rating-checkbox svg {
            display: block;
            color: #16A34A;
        }

        .rating-btn.selected.satisfactory .rating-checkbox svg {
            display: block;
            color: #CA8A04;
        }

        .rating-btn.selected.needs_improvement .rating-checkbox svg {
            display: block;
            color: #DC2626;
        }

        .pqc-info-note {
            background-color: #EFF6FF;
            border: 2px solid #BFDBFE;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .pqc-info-note p {
            color: #1E40AF;
            font-weight: 600;
            font-size: 12px;
        }

        .pqc-info-note .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            margin-top: 4px;
        }

        /* PAGE 11 SPECIFIC STYLES - Completion Page */
        #page11.active {
            background: linear-gradient(135deg, #F0FDF4 0%, #FFFFFF 50%, #F0FDF4 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-y: auto;
            padding: 20px 0;
        }

        @media (max-width: 768px) {
            #page11.active {
                padding: 0;
                align-items: flex-start;
            }
        }

        .completion-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            overflow: visible;
            border: 2px solid #BBF7D0;
            max-width: 700px;
            width: 100%;
            margin: 20px;
            animation: slideUp 0.8s ease-out;
        }

        @media (max-width: 768px) {
            .completion-card {
                margin: 0;
                border-radius: 0;
                border-left: none;
                border-right: none;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }
        }

        .completion-header {
            background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%);
            padding: 32px 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .completion-header {
                padding: 24px 20px;
            }
        }

        .completion-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background-color: #15803D;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .safety-banner {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background-color: #15803D;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .safety-banner svg {
            width: 20px;
            height: 20px;
            color: #FFFFFF;
        }

        .safety-banner p {
            color: #FFFFFF;
            font-weight: 700;
            font-size: 13px;
        }

        .success-icon-wrapper {
            margin-top: 24px;
            margin-bottom: 16px;
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .success-icon {
            display: inline-block;
            background-color: #FFFFFF;
            border-radius: 50%;
            padding: 24px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            animation: pulseGlow 2s ease-in-out infinite;
        }

        .success-icon svg {
            width: 80px;
            height: 80px;
            color: #22C55E;
        }

        .completion-title {
            font-size: 36px;
            font-weight: 900;
            color: #FFFFFF;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .tric-id {
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
            opacity: 0.95;
        }

        .completion-content {
            padding: 32px 24px;
        }

        @media (max-width: 768px) {
            .completion-content {
                padding: 24px 20px;
                flex: 1;
            }
        }

        .urdu-message-box {
            background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%);
            border-radius: 16px;
            padding: 24px;
            border: 2px solid #BBF7D0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 16px;
        }

        @media (max-width: 768px) {
            .urdu-message-box {
                padding: 16px;
                border-radius: 12px;
            }
        }

        .urdu-message-box p {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: #166534;
            font-weight: 700;
            font-size: 20px;
            line-height: 1.8;
            text-align: center;
            margin-bottom: 16px;
        }

        @media (max-width: 768px) {
            .urdu-message-box p {
                font-size: 16px;
                margin-bottom: 12px;
            }
        }

        .urdu-message-box .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #86EFAC, transparent);
            margin: 16px 0;
        }

        .english-message-box {
            background-color: #EFF6FF;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid #BFDBFE;
            margin-bottom: 24px;
        }

        .english-message-box p {
            color: #1E40AF;
            font-weight: 600;
            font-size: 14px;
            text-align: center;
            line-height: 1.6;
        }

        .download-btn {
            width: 100%;
            background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%);
            color: #FFFFFF;
            font-weight: 700;
            font-size: 18px;
            padding: 16px;
            border-radius: 16px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .download-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 24px rgba(34, 197, 94, 0.4);
        }

        .download-btn svg {
            width: 24px;
            height: 24px;
        }

        .download-btn-text {
            text-align: left;
        }

        .download-btn-text p {
            font-weight: 700;
        }

        .download-btn-text .sub {
            font-size: 12px;
            opacity: 0.9;
            font-family: Arial;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 768px) {
            .button-group {
                gap: 8px;
                margin-top: 16px;
            }
        }

        .btn-secondary {
            background-color: #F3F4F6;
            color: var(--color-text);
            font-weight: 600;
            padding: 12px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background-color: #E5E7EB;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-home {
            background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
            color: #FFFFFF;
            font-weight: 600;
            padding: 12px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-center: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
        }

        .btn-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
        }

        .completion-footer {
            background: linear-gradient(90deg, #F9FAFB 0%, #F3F4F6 100%);
            padding: 16px 24px;
            border-top: 1px solid #E5E7EB;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .completion-footer {
                padding: 12px 16px;
                flex-wrap: wrap;
                gap: 8px;
            }
        }

        .completion-footer p {
            font-size: 12px;
            color: var(--color-text-light);
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background-color: #22C55E;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(34, 197, 94, 0.4), 0 0 40px rgba(34, 197, 94, 0.2);
            }
            50% {
                box-shadow: 0 0 30px rgba(34, 197, 94, 0.6), 0 0 60px rgba(34, 197, 94, 0.4);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* PAGE 9 SPECIFIC STYLES - Signatures */
        .page9-container {
            background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
        }

        @media (max-width: 768px) {
            .page9-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                box-shadow: none;
            }
        }

        .page9-header {
            text-align: center;
            padding: 24px 16px;
            background: linear-gradient(135deg, #FB923C 0%, #F97316 100%);
            box-shadow: 0 4px 12px rgba(251, 146, 60, 0.3);
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .page9-header {
                padding: 12px 16px;
            }
        }

        .page9-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        .page9-header p {
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 600;
        }

        #page9 .form-content {
            background: transparent;
            padding: 16px;
            flex: 1;
            overflow-y: auto;
        }

        .signature-card {
            background: linear-gradient(135deg, #EFF6FF 0%, #FFFFFF 100%);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid #93C5FD;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .signature-card.supervisor {
            background: linear-gradient(135deg, #DBEAFE 0%, #FFFFFF 100%);
            border-color: #60A5FA;
        }

        .signature-card.error {
            border-color: #EF4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        }

        .signature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .signature-info h3 {
            font-size: 18px;
            font-weight: 700;
            color: #1E40AF;
            margin-bottom: 4px;
        }

        .signature-card.member .signature-info h3 {
            color: #EA580C;
        }

        .signature-info p {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
        }

        .signature-info .emp-id {
            color: var(--color-text-light);
            font-size: 12px;
        }

        .signature-error-badge {
            background-color: #FEE2E2;
            color: #EF4444;
            font-size: 11px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 20px;
        }

        .signature-canvas-wrapper {
            margin-bottom: 12px;
        }

        .signature-canvas-container {
            background-color: #FFFFFF;
            border-radius: 8px;
            border: 2px dashed #93C5FD;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .signature-card.member .signature-canvas-container {
            border-color: #FED7AA;
        }

        .signature-canvas-container.error {
            border-color: #F87171;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
        }

        .signature-canvas {
            width: 100%;
            display: block;
            cursor: crosshair;
            touch-action: none;
        }

        .signature-canvas.supervisor {
            height: 150px;
        }

        .signature-canvas.member {
            height: 120px;
        }

        .signature-hint {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
            color: var(--color-text-light);
        }

        .signature-hint.error {
            color: #EF4444;
        }

        .clear-signature-btn {
            width: 100%;
            padding: 10px;
            background-color: #E5E7EB;
            color: var(--color-text);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .clear-signature-btn:hover {
            background-color: #D1D5DB;
        }

        .signatures-divider {
            text-align: center;
            padding: 16px 0;
            margin: 20px 0;
            border-bottom: 2px solid #FB923C;
        }

        .signatures-divider h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .signatures-divider .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 16px;
            color: var(--color-text-light);
        }

        /* PAGE 9 SPECIFIC STYLES - Signatures */
        .page9-container {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
        }

        .page9-header {
            text-align: center;
            padding: 24px 16px;
            background: linear-gradient(135deg, #FB923C 0%, #F97316 100%);
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            flex-shrink: 0;
        }

        .page9-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        .page9-header p {
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 600;
        }

        #page9 .form-content {
            background-color: #FFFFFF;
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .signature-card {
            background-color: #FFFFFF;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--color-border);
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s;
        }

        .signature-card.error {
            border-color: #EF4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        }

        .signature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #F97316;
        }

        .signature-info h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 6px;
        }

        .signature-info p {
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-light);
        }

        .signature-error-badge {
            background-color: #FEE2E2;
            color: #EF4444;
            font-size: 11px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 20px;
        }

        .signature-canvas-wrapper {
            margin-bottom: 12px;
        }

        .signature-canvas-container {
            background-color: #FAFAFA;
            border-radius: 8px;
            border: 2px dashed var(--color-border);
            overflow: hidden;
        }

        .signature-canvas-container.error {
            border-color: #F87171;
            background-color: #FEF2F2;
        }

        .signature-canvas {
            width: 100%;
            display: block;
            cursor: crosshair;
            touch-action: none;
            background-color: #FFFFFF;
        }

        .signature-canvas.supervisor {
            height: 150px;
        }

        .signature-canvas.member {
            height: 120px;
        }

        .signature-hint {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
            color: var(--color-text-light);
        }

        .signature-hint.error {
            color: #EF4444;
        }

        .clear-signature-btn {
            width: 100%;
            padding: 10px;
            background-color: #F3F4F6;
            color: var(--color-text);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .clear-signature-btn:hover {
            background-color: #E5E7EB;
        }

        .signatures-section-title {
            text-align: center;
            padding: 20px 0;
            margin: 20px 0;
            border-top: 2px solid var(--color-border);
            border-bottom: 2px solid var(--color-border);
        }

        .signatures-section-title h2 {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 6px;
        }

        .signatures-section-title .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 15px;
            color: var(--color-text-light);
        }

        /* Standardized Navigation Buttons - Matching Design */
        .page-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background-color: #F9FAFB;
            border-top: 1px solid #E5E7EB;
            flex-shrink: 0;
        }

        .page2-container .page-footer,
        .page3-container .page-footer,
        .page4-container .page-footer,
        .page5-container .page-footer,
        .page6-container .page-footer,
        .page7-container .page-footer,
        .page8-container .page-footer,
        .page9-container .page-footer {
            border-radius: 0 0 12px 12px;
        }

        .btn-back, .btn-next {
            padding: 14px 40px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-back {
            background-color: #9CA3AF;
            color: #FFFFFF;
        }

        .btn-back:hover {
            background-color: #6B7280;
        }

        .btn-next {
            background-color: var(--color-primary);
            color: #FFFFFF;
        }

        .btn-next:hover {
            background-color: var(--color-primary-dark);
        }

        /* PAGE 8 SPECIFIC STYLES - Conversation with Team */
        .page8-container {
            background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
        }

        @media (max-width: 768px) {
            .page8-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                box-shadow: none;
            }
        }

        .page8-header {
            text-align: center;
            padding: 24px 16px;
            background: linear-gradient(135deg, #FB923C 0%, #F97316 100%);
            box-shadow: 0 4px 12px rgba(251, 146, 60, 0.3);
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .page8-header {
                padding: 12px 16px;
            }
        }

        .page8-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        .page8-header p {
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
        }

        #page8 .form-content {
            background: transparent;
            padding: 24px;
            flex: 1;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            #page8 .form-content {
                padding: 16px 12px;
            }
        }

        #page8 .error-banner {
            background-color: #FEF2F2;
            border: 2px solid #EF4444;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            display: none;
        }

        #page8 .error-banner.show {
            display: flex;
        }

        .conversation-section {
            background: linear-gradient(135deg, #FFF8F0 0%, #FFFFFF 100%);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid #FFE4CC;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s;
        }

        .conversation-section.error {
            border-color: #EF4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        }

        .conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .conversation-header h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-text);
        }

        .conversation-header .error-badge {
            background-color: #FEE2E2;
            color: #EF4444;
            font-size: 11px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 20px;
        }

        .conversation-point {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid #FFE4CC;
            transition: all 0.2s;
        }

        .conversation-point:last-child {
            border-bottom: none;
        }

        .conversation-point.error {
            background-color: #FEF2F2;
            border-radius: 8px;
            margin: -4px;
            padding: 16px;
        }

        .point-number {
            width: 24px;
            height: 24px;
            background-color: #F97316;
            color: #FFFFFF;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .point-text {
            flex: 1;
        }

        .point-text .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: #F97316;
            font-weight: 700;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 4px;
        }

        .point-text .english {
            color: var(--color-text-light);
            font-weight: 500;
            font-size: 12px;
        }

        .point-text .point-error {
            color: #EF4444;
            font-size: 11px;
            font-weight: 600;
            margin-top: 4px;
        }

        .checkbox-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 2px solid #D1D5DB;
            background-color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .checkbox-btn:hover {
            border-color: #F97316;
        }

        .checkbox-btn.checked {
            background-color: var(--color-success);
            border-color: var(--color-success);
            transform: scale(1.1);
        }

        .checkbox-btn.error {
            border-color: #F87171;
            background-color: #FEF2F2;
        }

        .checkbox-btn svg {
            width: 20px;
            height: 20px;
            color: #FFFFFF;
        }

        .warning-box {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            padding: 20px;
            border: 2px solid #B91C1C;
            margin-bottom: 16px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .warning-icon {
            background-color: #FFFFFF;
            border-radius: 50%;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }

        .warning-icon svg {
            width: 32px;
            height: 32px;
            color: #EF4444;
        }

        .warning-text {
            flex: 1;
        }

        .warning-text .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: #FFFFFF;
            font-weight: 700;
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .warning-text .english {
            color: #FFFFFF;
            font-weight: 600;
            font-size: 14px;
            line-height: 1.5;
        }

        .oath-section {
            max-width: 640px;
            margin: 0 auto;
            background: linear-gradient(135deg, #FFFFFF 0%, #F0FDF4 100%);
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border: 2px solid #D1D5DB;
            padding: 32px;
            transition: all 0.5s;
        }

        .oath-section.checked {
            border-color: #22C55E;
            box-shadow: 0 0 40px rgba(34, 197, 94, 0.4), 0 0 80px rgba(34, 197, 94, 0.2);
        }

        .oath-section.error {
            border-color: #EF4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        }

        .oath-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .oath-icon {
            display: inline-block;
            background-color: #DCFCE7;
            border-radius: 50%;
            padding: 16px;
            margin-bottom: 16px;
        }

        .oath-icon svg {
            width: 48px;
            height: 48px;
            color: #22C55E;
        }

        .oath-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 12px;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        .oath-header .error-badge {
            display: inline-block;
            background-color: #FEE2E2;
            color: #EF4444;
            font-size: 13px;
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 20px;
        }

        .oath-content {
            background-color: #FFFFFF;
            border-radius: 12px;
            padding: 24px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #E5E7EB;
            margin-bottom: 24px;
        }

        .oath-content .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: var(--color-text);
            font-weight: 700;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 16px;
            text-align: center;
        }

        .oath-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #D1D5DB, transparent);
            margin: 16px 0;
        }

        .oath-content .english {
            color: var(--color-text-light);
            font-weight: 600;
            font-size: 16px;
            line-height: 1.6;
            text-align: center;
        }

        .oath-button-container {
            display: flex;
            justify-content: center;
        }

        .oath-btn {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 32px;
            border-radius: 16px;
            border: 4px solid #86EFAC;
            background-color: #FFFFFF;
            color: #16A34A;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .oath-btn:hover {
            border-color: #4ADE80;
            transform: scale(1.05);
        }

        .oath-btn.checked {
            background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%);
            color: #FFFFFF;
            border-color: #FFFFFF;
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(34, 197, 94, 0.4);
        }

        .oath-btn.error {
            border-color: #F87171;
            background-color: #FFFFFF;
            color: #DC2626;
        }

        .oath-checkbox {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            border: 4px solid #D1D5DB;
            background-color: #F9FAFB;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .oath-btn.checked .oath-checkbox {
            background-color: #FFFFFF;
            border-color: #FFFFFF;
        }

        .oath-checkbox svg {
            width: 32px;
            height: 32px;
            color: #22C55E;
        }

        .oath-labels {
            text-align: left;
        }

        .oath-labels .main {
            font-size: 18px;
            font-weight: 700;
        }

        .oath-labels .sub {
            font-size: 14px;
            opacity: 0.9;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        .oath-success {
            margin-top: 24px;
            padding: 16px;
            background-color: #DCFCE7;
            border: 2px solid #86EFAC;
            border-radius: 12px;
            text-align: center;
            animation: slideDown 0.3s ease-out;
        }

        .oath-success p {
            color: #166534;
            font-weight: 600;
            font-size: 14px;
        }

        .oath-success .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* PAGE 7 SPECIFIC STYLES - Hazards & Controls */
        .page7-container {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .page7-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                box-shadow: none;
            }
        }

        .page7-header {
            text-align: center;
            padding: 24px;
            background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%);
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .page7-header {
                padding: 12px 16px;
                border-radius: 0;
            }
        }

        .page7-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        .page7-header .subtitle {
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        .page7-header p {
            color: #FFFFFF;
            font-size: 13px;
            font-weight: 600;
            opacity: 0.95;
        }

        #page7 .form-content {
            background-color: #FFFFFF;
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        @media (max-width: 768px) {
            #page7 .form-content {
                padding-bottom: 80px;
            }
        }

        #page7 .error-banner {
            display: none;
            align-items: flex-start;
        }

        #page7 .error-banner.show {
            display: flex;
        }

        #page7 .error-banner svg {
            width: 24px;
            height: 24px;
            color: #EF4444;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .error-banner-content {
            margin-left: 12px;
            flex: 1;
        }

        .error-banner-content p {
            color: #EF4444;
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .hazard-card {
            background-color: #FFF8F0;
            border-radius: 12px;
            border: 2px solid #FFE4CC;
            margin-bottom: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }

        .hazard-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .hazard-card.error {
            border-color: #EF4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        }

        .hazard-header {
            background: linear-gradient(135deg, #FB923C 0%, #F97316 100%);
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .hazard-title {
            flex: 1;
            min-width: 0;
        }

        .hazard-title h3 {
            color: #FFFFFF;
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .hazard-title p {
            color: var(--color-text);
            font-weight: 600;
            font-size: 14px;
        }

        .hazard-title .error-text {
            color: #EF4444;
            font-size: 11px;
            font-weight: 600;
            margin-top: 4px;
        }

        .hazard-buttons {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .hazard-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: none;
            background-color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .hazard-btn svg {
            width: 24px;
            height: 24px;
            color: var(--color-text-light);
        }

        .hazard-btn.active-yes {
            background-color: var(--color-success);
        }

        .hazard-btn.active-yes svg {
            color: #FFFFFF;
        }

        .hazard-btn.active-no {
            background-color: #EF4444;
        }

        .hazard-btn.active-no svg {
            color: #FFFFFF;
        }

        .controls-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .controls-section.show {
            max-height: 2000px;
        }

        .controls-divider {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 16px 0;
            padding: 0 16px;
        }

        .controls-divider .line {
            flex: 1;
            height: 1px;
            background-color: var(--color-border);
        }

        .controls-divider span {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text-light);
        }

        .controls-list {
            padding: 0 16px 16px;
        }

        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            padding: 12px;
            background-color: #FFFFFF;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid var(--color-border);
            transition: all 0.2s;
        }

        .control-item.error {
            border-color: #EF4444;
            background-color: #FEF2F2;
        }

        .control-text {
            flex: 1;
        }

        .control-text .urdu-text {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 13px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .control-text .english-text {
            font-size: 12px;
            color: var(--color-text-light);
        }

        .control-text .error-text {
            color: #EF4444;
            font-size: 10px;
            font-weight: 600;
            margin-top: 4px;
        }

        .control-buttons {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }

        .control-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 1px solid var(--color-border);
            background-color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn svg {
            width: 18px;
            height: 18px;
            color: var(--color-text-light);
        }

        .control-btn.active-yes {
            background-color: var(--color-success);
            border-color: var(--color-success);
        }

        .control-btn.active-yes svg {
            color: #FFFFFF;
        }

        .control-btn.active-no {
            background-color: #EF4444;
            border-color: #EF4444;
        }

        .control-btn.active-no svg {
            color: #FFFFFF;
        }

        .special-control {
            padding: 16px;
            background-color: #EFF6FF;
            border-radius: 8px;
            border: 2px solid #3B82F6;
            margin-bottom: 8px;
        }

        .special-control.error {
            border-color: #EF4444;
            background-color: #FEF2F2;
        }

        .special-control-label {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 13px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .special-control-subtitle {
            font-size: 12px;
            color: var(--color-text-light);
            margin-bottom: 12px;
        }

        .special-control .error-text {
            color: #EF4444;
            font-size: 10px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .pole-options {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .pole-btn {
            flex: 1;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--color-border);
            background-color: #FFFFFF;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--color-text-light);
            transition: all 0.2s;
        }

        .pole-btn.active {
            background-color: #3B82F6;
            color: #FFFFFF;
            border-color: #3B82F6;
        }

        .pole-input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid var(--color-border);
            font-size: 14px;
        }

        .pole-input.error {
            border-color: #EF4444;
            background-color: #FEF2F2;
        }

        .pole-input:disabled {
            background-color: #F3F4F6;
            cursor: not-allowed;
        }

        .other-hazards-section {
            margin-top: 16px;
            padding: 16px;
            background-color: #F9FAFB;
            border-radius: 8px;
            border: 1px solid var(--color-border);
        }

        @media (max-width: 768px) {
            .other-hazards-section {
                margin-bottom: 20px;
            }
        }

        .other-hazards-section label {
            display: block;
            font-weight: 600;
            font-size: 14px;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .other-hazards-section .urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: var(--color-text-light);
            font-size: 12px;
        }

        .other-hazards-section textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid var(--color-border);
            font-size: 14px;
            resize: vertical;
        }

        @media (max-width: 768px) {
            .other-hazards-section textarea {
                max-height: 150px;
            }
        }

        /* PAGE 6 SPECIFIC STYLES */
        .page6-container {
            background-color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .page6-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                box-shadow: none;
            }
        }

        .page6-header {
            text-align: center;
            padding: 24px;
            background-color: var(--color-primary);
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .page6-header {
                padding: 12px 16px;
                border-radius: 0;
            }
        }

        .page6-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
        }

        .page6-header p {
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
        }

        #page6 .form-content {
            background-color: #FFFFFF;
        }

        .instruction-card {
            background-color: #FFFFFF;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--color-border);
            transition: all 0.2s;
        }

        .instruction-card.error {
            border: 2px solid #EF4444;
            background-color: #FEF2F2;
        }

        .urdu-text {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            color: var(--color-primary);
            font-weight: 600;
            font-size: 14px;
            line-height: 1.8;
            margin-bottom: 8px;
        }

        .english-text {
            color: var(--color-text-light);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .instruction-error {
            color: #EF4444;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
            display: none;
        }

        .instruction-error.show {
            display: block;
        }

        .button-group {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .status-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 24px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            background-color: #FFFFFF;
            color: var(--color-text-light);
            outline: 1px solid #D1D5DB;
        }

        .status-btn.active-yes {
            background-color: var(--color-success);
            color: #FFFFFF;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            outline: none;
        }

        .status-btn.active-no {
            background-color: #EF4444;
            color: #FFFFFF;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            outline: none;
        }

        .status-btn svg {
            width: 20px;
            height: 20px;
        }

        /* PAGE 4 & PAGE 5 SPECIFIC STYLES */
        .page4-container, .page5-container {
            background-color: var(--color-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .page4-container, .page5-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                box-shadow: none;
            }
        }

        /* Page 4: Tools styling */
        #page4 .form-content {
            background-color: #F5F5F5;
        }

        /* Page 5: PPE styling */
        #page5 .form-content {
            background-color: #FFFFFF;
        }

        #page5 .ppe-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        #page5 .ppe-card {
            position: relative;
            background-color: #FFFFFF;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #FFE4CC;
            transition: all 0.2s;
        }

        #page5 .ppe-card.error {
            border: 2px solid #EF4444;
            background-color: #FEF2F2;
        }

        #page5 .ppe-card.removable .remove-btn {
            display: flex;
        }

        #page5 .ppe-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        #page5 .ppe-name-urdu {
            font-family: Arial, 'Noto Nastaliq Urdu', sans-serif;
            direction: rtl;
            font-size: 11px;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 12px;
        }

        #page5 .ppe-error {
            color: #EF4444;
            font-size: 10px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 8px;
        }

        #page5 .ppe-buttons {
            display: flex;
            gap: 4px;
        }

        #page5 .ppe-btn {
            flex: 1;
            padding: 8px 4px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            background-color: #FFFFFF;
            color: var(--color-text-light);
            border: 1px solid #D1D5DB;
        }

        #page5 .ppe-btn.active-available {
            background-color: var(--color-success);
            color: #FFFFFF;
            border-color: var(--color-success);
        }

        #page5 .ppe-btn.active-not-available {
            background-color: #EF4444;
            color: #FFFFFF;
            border-color: #EF4444;
        }

        #page5 .ppe-btn.active-na {
            background-color: #6B7280;
            color: #FFFFFF;
            border-color: #6B7280;
        }

        .add-ppe-section {
            margin-top: 16px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .title {
                font-size: 36px;
            }

            .welcome-title {
                font-size: 28px;
            }

            .content {
                padding: 24px 20px;
            }

            .page2-container, .page3-container, .page4-container, .page5-container, .page6-container {
                height: 95vh;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .choice-buttons {
                flex-direction: column;
            }

            .page-footer {
                flex-direction: row;
                padding: 16px 12px;
            }

            .btn-back, .btn-next {
                flex: 1;
                font-size: 14px;
                padding: 12px 16px;
            }

            .tools-grid, #page5 .ppe-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .status-btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .title {
                font-size: 32px;
            }

            .tagline {
                font-size: 12px;
                padding: 10px 20px;
            }

            .welcome-title {
                font-size: 24px;
            }

            .btn {
                font-size: 16px;
                padding: 14px;
            }

            .page2-header h1, .page3-header h1, .page4-header h1 {
                font-size: 20px;
            }

            .form-content {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- PAGE 1: WELCOME PAGE -->
        <div id="page1" class="page active">
            <div class="card">
                <!-- Header -->
                <div class="header">
                    <div class="badge">
                        <span class="badge-text"></span>
                    </div>
                    <h1 class="title">TRIC FORM</h1>
                    <div class="tagline">
                        Tool Box Talk Risk Identification Card
                    </div>
                </div>

                <!-- Content -->
                <div class="content">
                    <!-- Welcome Box -->
                    <div class="welcome-box">
                        <h2 class="welcome-title">WELCOME</h2>
                        <p class="urdu-text" style="font-family: Arial, 'Noto Nastaliq Urdu', sans-serif; direction: rtl; font-size: 18px; font-weight: 600; color: #F97316; text-align: center; margin-top: 12px;">
                                   
                        </p>
                    </div>

                    <!-- Start Form Button -->
                    <button class="btn btn-start" onclick="startNewForm()">
                        <span>Start Form</span>
                        <svg style="width: 24px; height: 34px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                        </svg>
                    </button>
                   
                </div>

                <!-- Footer -->
                <div class="footer">
                    <p class="footer-text">Powered by K-Electric CHSEQ</p>
                </div>
            </div>
        </div>

        <!-- PAGE 2: Basic Information -->
        <div id="page2" class="page">
            <div class="page2-container">
                <!-- Header -->
                <div class="page2-header">
                    <h1>TRIC FORM</h1>
                    <p>Tool Box Talk Risk Identification Card</p>
                </div>

                <!-- Form Content -->
                <div class="form-content">
                    <!-- Info Section -->
                    <div class="info-section">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Date: <span class="urdu"></span></label>
                                <div class="info-value" id="date">-</div>
                            </div>
                            <div class="info-item">
                                <label>Time: <span class="urdu"></span></label>
                                <div class="info-value" id="time">-</div>
                            </div>
                            <div class="info-item">
                                <label>TRIC ID: <span class="urdu"> </span></label>
                                <div class="info-value" id="tricId">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Basic Details -->
                    <div class="section">
                        <div class="section-header">
                            <h2>Basic Details</h2>
                            <span class="urdu"> </span>
                        </div>
                        <div class="section-body">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>BU: <span class="urdu"> </span></label>
                                    <input type="text" class="form-input" id="bu" name="bu" placeholder="Enter BU">
                                    <div class="error-message" id="error-bu" style="display: none;">Required / </div>
                                </div>
                                <div class="form-group">
                                    <label>Region: <span class="urdu"></span></label>
                                    <input type="text" class="form-input" id="region" name="region" placeholder="Enter region">
                                    <div class="error-message" id="error-region" style="display: none;">Required / </div>
                                </div>
                                <div class="form-group">
                                    <label>Cluster/Zone: <span class="urdu">/</span></label>
                                    <input type="text" class="form-input" id="clusterZone" name="clusterZone" placeholder="Enter cluster/zone">
                                    <div class="error-message" id="error-clusterZone" style="display: none;">Required / </div>
                                </div>
                                <div class="form-group">
                                    <label>IBC: <span class="urdu">  </span></label>
                                    <input type="text" class="form-input" id="ibc" name="ibc" placeholder="Enter IBC">
                                    <div class="error-message" id="error-ibc" style="display: none;">Required / </div>
                                </div>
                                <div class="form-group">
                                    <label>Dept./Section: <span class="urdu">/</span></label>
                                    <input type="text" class="form-input" id="deptSection" name="deptSection" placeholder="Enter department/section">
                                    <div class="error-message" id="error-deptSection" style="display: none;">Required / </div>
                                </div>
                                <div class="form-group">
                                    <label>Sub Dept.: <span class="urdu"> </span></label>
                                    <input type="text" class="form-input" id="subDept" name="subDept" placeholder="Enter sub department">
                                    <div class="error-message" id="error-subDept" style="display: none;">Required / </div>
                                </div>
                                <div class="form-group full-width">
                                    <label>MTL No: <span class="urdu">   </span></label>
                                    <input type="text" class="form-input" id="mtlNo" name="mtlNo" placeholder="Enter MTL number">
                                    <div class="error-message" id="error-mtlNo" style="display: none;">Required / </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Work Location and Details -->
                    <div class="section">
                        <div class="section-header">
                            <h2>Work Location and Details</h2>
                            <span class="urdu">    </span>
                        </div>
                        <div class="section-body">
                            <div class="form-group">
                                <label>Job Location: <span class="urdu">  </span></label>
                                <input type="text" class="form-input" id="jobLocation" name="jobLocation" placeholder="Enter job location">
                                <div class="error-message" id="error-jobLocation" style="display: none;">Required / </div>
                            </div>

                            <div class="form-group">
                                <label>Work Details: <span class="urdu">  </span></label>
                                <textarea class="form-input" id="workDetails" name="workDetails" placeholder="Enter work details" rows="3"></textarea>
                                <div class="error-message" id="error-workDetails" style="display: none;">Required / </div>
                            </div>

                            <!-- PTW Section -->
                            <div class="choice-section" id="ptw-section">
                                <label>PTW (Permit to Work): <span class="urdu">  </span></label>
                                <div class="error-message" id="error-ptwStatus" style="display: none; margin-bottom: 8px;">Please select Yes/No /     </div>
                                <div class="choice-buttons">
                                    <button type="button" class="choice-btn" id="ptw-yes" onclick="handlePTWChange('yes')">Yes / </button>
                                    <button type="button" class="choice-btn" id="ptw-no" onclick="handlePTWChange('no')">No / </button>
                                </div>
                                <input type="text" class="form-input" id="ptwNo" name="ptwNo" placeholder="Enter PTW Number" disabled>
                                <div class="error-message" id="error-ptwNo" style="display: none;">Required / </div>
                            </div>

                            <!-- LOTO Section -->
                            <div class="choice-section" id="loto-section">
                                <label>LOTO (Lock Out Tag Out): <span class="urdu">   </span></label>
                                <div class="error-message" id="error-lotoStatus" style="display: none; margin-bottom: 8px;">Please select Yes/No /     </div>
                                <div class="choice-buttons">
                                    <button type="button" class="choice-btn" id="loto-yes" onclick="handleLOTOChange('yes')">Yes / </button>
                                    <button type="button" class="choice-btn" id="loto-no" onclick="handleLOTOChange('no')">No / </button>
                                </div>
                                <input type="text" class="form-input" id="lotoNo" name="lotoNo" placeholder="Enter LOTO Number" disabled>
                                <div class="error-message" id="error-lotoNo" style="display: none;">Required / </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="page-footer">
                    <button class="btn-back" onclick="handlePage2Back()">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <button class="btn-next" onclick="handlePage2Next()">
                        Next
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 3: Team Members -->
        <div id="page3" class="page">
            <div class="page3-container">
                <!-- Header -->
                <div class="page3-header">
                    <h1>Team Members</h1>
                    <p class="urdu"> </p>
                </div>

                <!-- Form Content -->
                <div class="form-content">
                    <!-- Supervisor Section -->
                    <div class="section" id="supervisor-section">
                        <div class="section-title">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                            </svg>
                            Supervisor (Required)
                        </div>
                        <p class="section-title-urdu"></p>

                        <div class="error-message" id="error-supervisor" style="display: none; margin-bottom: 12px;">
                            Required / 
                        </div>

                        <div class="form-group">
                            <label>Supervisor Name: <span class="label-urdu">  </span></label>
                            <input type="text" class="form-input" id="supervisor-name" name="supervisor-name" placeholder="Enter supervisor name">
                            <div class="error-message" id="error-supervisor-name" style="display: none;">Required / </div>
                        </div>

                        <div class="form-group">
                            <label>Emp. ID/CNIC: <span class="label-urdu"> / </span></label>
                            <input type="text" class="form-input" id="supervisor-empid" name="supervisor-empid" placeholder="Enter employee ID or CNIC">
                            <div class="error-message" id="error-supervisor-empid" style="display: none;">Required / </div>
                        </div>
                    </div>

                    <!-- PQC Section -->
                    <div class="section" id="pqc-section">
                        <div class="section-title">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            PQC Supervisor
                        </div>
                        <p class="section-title-urdu">  </p>

                        <div class="form-group">
                            <label>Is PQC Supervisor Required? <span class="label-urdu"> PQC   </span></label>
                            <div class="error-message" id="error-pqc" style="display: none; margin-bottom: 8px;">Please select Yes/No /     </div>
                            <div class="choice-buttons">
                                <button type="button" class="choice-btn" id="pqc-yes" onclick="handlePQCChange('yes')">Yes / </button>
                                <button type="button" class="choice-btn" id="pqc-no" onclick="handlePQCChange('no')">No / </button>
                            </div>
                        </div>

                        <div id="pqc-fields" style="display: none;">
                            <div class="form-group">
                                <label>PQC Supervisor Name: <span class="label-urdu">  </span></label>
                                <input type="text" class="form-input" id="pqc-name" name="pqc-name" placeholder="Enter PQC supervisor name">
                                <div class="error-message" id="error-pqc-name" style="display: none;">Required / </div>
                            </div>

                            <div class="form-group">
                                <label>Emp. ID/CNIC: <span class="label-urdu"> / </span></label>
                                <input type="text" class="form-input" id="pqc-empid" name="pqc-empid" placeholder="Enter employee ID or CNIC">
                                <div class="error-message" id="error-pqc-empid" style="display: none;">Required / </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fixed Team Member -->
                    <div class="section" id="member-section">
                        <div class="section-title">
                            <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"/>
                            </svg>
                            Team Member (Required)
                        </div>
                        <p class="section-title-urdu"> </p>

                        <div class="error-message" id="error-member" style="display: none; margin-bottom: 12px;">
                            Required / 
                        </div>

                        <div class="form-group">
                            <label>Member Name: <span class="label-urdu">  </span></label>
                            <input type="text" class="form-input" id="member-name" name="member-name" placeholder="Enter member name">
                            <div class="error-message" id="error-member-name" style="display: none;">Required / </div>
                        </div>

                        <div class="form-group">
                            <label>Emp. ID/CNIC: <span class="label-urdu"> / </span></label>
                            <input type="text" class="form-input" id="member-empid" name="member-empid" placeholder="Enter employee ID or CNIC">
                            <div class="error-message" id="error-member-empid" style="display: none;">Required / </div>
                        </div>
                    </div>

                    <!-- Additional Members Container -->
                    <div id="additional-members"></div>

                    <!-- Add More Button -->
                    <button class="add-btn" onclick="addMember()">
                        <span style="font-size: 20px;">+</span>
                        Add more member
                    </button>
                </div>

                <!-- Footer -->
                <div class="page-footer">
                    <button class="btn-back" onclick="handlePage3Back()">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <button class="btn-next" onclick="handlePage3Next()">
                        Next
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 4: Tools Requirements -->
        <div id="page4" class="page">
            <div class="page4-container">
                <!-- Header -->
                <div class="page4-header">
                    <h1>Tools Requirements</h1>
                    <p class="urdu">      <br>       <br>   </p>
                </div>

                <!-- Form Content -->
                <div class="form-content">
                    <div class="error-banner" id="error-banner-tools">
                        <p>Please select status for all tools</p>
                        <p class="urdu">        </p>
                    </div>

                    <div class="tools-grid" id="tools-grid"></div>

                    <div class="add-tool-section">
                        <input 
                            type="text" 
                            class="form-input" 
                            id="new-tool" 
                            placeholder="Enter new tool..."
                            onkeypress="if(event.key==='Enter') addTool()"
                        >
                        <button class="add-btn" onclick="addTool()">
                            <span style="font-size: 20px;">+</span>
                            Add more tools
                        </button>
                    </div>
                </div>

                <!-- Footer -->
                <div class="page-footer">
                    <button class="btn-back" onclick="handlePage4Back()">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <button class="btn-next" onclick="handlePage4Next()">
                        Next
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 5: PPE Requirements -->
        <div id="page5" class="page">
            <div class="page5-container">
                <!-- Header -->
                <div class="page4-header">
                    <h1>PPE Requirements</h1>
                    <p class="urdu">       <br>   (PPE) /    (SPE)<br>        </p>
                </div>

                <!-- Form Content -->
                <div class="form-content">
                    <div class="error-banner" id="error-banner-ppe">
                        <p>Please select status for all PPE items</p>
                        <p class="urdu">   PPE      </p>
                    </div>

                    <div class="ppe-grid" id="ppe-grid"></div>

                    <div class="add-ppe-section">
                        <input 
                            type="text" 
                            class="form-input" 
                            id="new-ppe" 
                            placeholder="Enter new PPE item..."
                            onkeypress="if(event.key==='Enter') addPPE()"
                        >
                        <button class="add-btn" onclick="addPPE()">
                            <span style="font-size: 20px;">+</span>
                            Add more PPE
                        </button>
                    </div>
                </div>

                <!-- Footer -->
                <div class="page-footer">
                    <button class="btn-back" onclick="handlePage5Back()">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <button class="btn-next" onclick="handlePage5Next()">
                        Next
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 6: Necessary Instructions -->
        <div id="page6" class="page">
            <div class="page6-container">
                <!-- Header -->
                <div class="page6-header">
                    <h1>Necessary Instructions for work</h1>
                    <p>    </p>
                </div>

                <!-- Form Content -->
                <div class="form-content" id="instructions-container">
                    <!-- Instructions will be dynamically inserted here -->
                </div>

                <!-- Footer -->
                <div class="page-footer">
                    <button class="btn-back" onclick="handlePage6Back()">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <button class="btn-next" onclick="handlePage6Next()">
                        Next
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 7: Hazards & Controls -->
        <div id="page7" class="page">
            <div class="page7-container">
                <!-- Header -->
                <div class="page7-header">
                    <h1>   </h1>
                    <p class="subtitle">Hazards & Control Measures</p>
                    <p>Identify hazards and confirm control measures</p>
                </div>

                <!-- Form Content -->
                <div class="form-content">
                    <div class="error-banner" id="error-banner-hazards">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div class="error-banner-content">
                            <p>Please answer all hazards and their control measures</p>
                            <p class="urdu">           </p>
                        </div>
                    </div>

                    <div id="hazards-container"></div>

                    <!-- Other Hazards -->
                    <div class="other-hazards-section">
                        <label>
                            Other Hazards (if any)
                            <span class="urdu">  (  )</span>
                        </label>
                        <textarea id="otherHazards" name="otherHazards" placeholder="Describe any other hazards..."></textarea>
                    </div>
                </div>

                <!-- Footer -->
                <div class="page-footer">
                    <button class="btn-back" onclick="handlePage7Back()">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <button class="btn-next" onclick="handlePage7Next()">
                        Next
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 8: Conversation with Team -->
        <div id="page8" class="page">
            <div class="page8-container">
                <!-- Header -->
                <div class="page8-header">
                    <h1>  </h1>
                    <p>Conversation with the team</p>
                </div>

                <!-- Form Content -->
                <div class="form-content">
                    <!-- Error Banner -->
                    <div class="error-banner" id="error-banner-page8">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 24px; height: 24px; color: #EF4444; flex-shrink: 0;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div style="margin-left: 12px; flex: 1;">
                            <p style="color: #EF4444; font-weight: 700; font-size: 14px; margin-bottom: 4px;">Please complete all required fields</p>
                            <p style="color: #EF4444; font-weight: 700; font-size: 14px; margin-bottom: 8px; font-family: Arial; direction: rtl;">      </p>
                            <ul style="color: #DC2626; font-size: 12px; list-style: none; padding: 0;">
                                <li id="error-conversations-text" style="display: none;"> All conversation points must be checked /      </li>
                                <li id="error-oath-text" style="display: none;"> Safety oath must be accepted /    </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Conversation Points -->
                    <div class="conversation-section" id="conversation-section">
                        <div class="conversation-header">
                            <h3>Discussion Points (Required) <span style="font-size: 14px; font-weight: 400; font-family: Arial;">()</span></h3>
                            <span class="error-badge" id="conversation-error-badge" style="display: none;"> All points required /   </span>
                        </div>
                        <div id="conversation-points"></div>
                    </div>

                    <!-- Warning Box -->
                    <div class="warning-box">
                        <div class="warning-icon">
                            <svg fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2L1 21h22L12 2zm0 3.5L19.5 19h-15L12 5.5zM11 10v4h2v-4h-2zm0 5v2h2v-2h-2z"/>
                            </svg>
                        </div>
                        <div class="warning-text">
                            <p class="urdu">                        </p>
                            <p class="english">If other hazards appear at the work site that cannot be controlled, stop the work activity and contact your line manager.</p>
                        </div>
                    </div>

                    <!-- Oath Section -->
                    <div class="oath-section" id="oath-section">
                        <div class="oath-header">
                            <div class="oath-icon">
                                <svg fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <h2> / Oath</h2>
                            <span class="error-badge" id="oath-error-badge" style="display: none;"> Oath must be accepted /     </span>
                        </div>

                        <div class="oath-content">
                            <p class="urdu">                  </p>
                            <div class="oath-divider"></div>
                            <p class="english">I hereby certify that all safety measures have been implemented and the work area is safe.</p>
                        </div>

                        <div class="oath-button-container">
                            <button class="oath-btn" id="oath-btn" onclick="toggleOath()">
                                <div class="oath-checkbox" id="oath-checkbox">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: none;" id="oath-check-icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                                <div class="oath-labels">
                                    <p class="main" id="oath-main-text">Accept Oath</p>
                                    <p class="sub" id="oath-sub-text">  </p>
                                </div>
                            </button>
                        </div>

                        <div class="oath-success" id="oath-success" style="display: none;">
                            <p> Thank you for accepting the safety oath</p>
                            <p class="urdu">     </p>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="page-footer" style="background-color: #F9FAFB; border-top: 1px solid #E5E7EB; border-radius: 0 0 12px 12px;">
                    <button class="btn-back" onclick="handlePage8Back()">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <button class="btn-next" onclick="handlePage8Next()">
                        Next
                        <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 9: Signatures -->
        <div id="page9" class="page">
            <div class="page9-container">
                <!-- Header -->
                <div class="page9-header">
                    <h1> / Signature</h1>
                    <p>Supervisor signature required to complete the TRIC Form</p>
                </div>

                <!-- Form Content -->
                <div class="form-content">
                    <!-- Error Banner -->
                    <div class="error-banner" id="error-banner-page9" style="margin-bottom: 16px;">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 24px; height: 24px; color: #EF4444; flex-shrink: 0;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <div style="margin-left: 12px; flex: 1;">
                            <p style="color: #EF4444; font-weight: 700; font-size: 14px; margin-bottom: 4px;">Supervisor signature is required</p>
                            <p style="color: #EF4444; font-weight: 700; font-size: 14px; font-family: Arial; direction: rtl;">    </p>
                        </div>
                    </div>

                    <!-- Supervisor Signature -->
                    <div class="signature-card" id="supervisor-signature-card">
                        <div class="signature-header">
                            <div class="signature-info">
                                <h3>Supervisor Signature /  </h3>
                                <p id="supervisor-name-display">Loading...</p>
                            </div>
                            <span class="signature-error-badge" id="supervisor-error-badge" style="display: none;"> Required / </span>
                        </div>
                        <div class="signature-canvas-wrapper">
                            <div class="signature-canvas-container" id="supervisor-canvas-container">
                                <canvas class="signature-canvas supervisor" id="supervisor-canvas" width="1000" height="150"></canvas>
                            </div>
                            <p class="signature-hint" id="supervisor-hint">Sign above /   </p>
                        </div>
                        <button class="clear-signature-btn" onclick="clearSignature('supervisor')">
                            Clear Signature /  
                        </button>
                    </div>

                    <!-- Information Note -->
                    <div style="margin-top: 24px; padding: 16px; background-color: #EFF6FF; border: 1px solid #BFDBFE; border-radius: 8px;">
                        <div style="display: flex; align-items: start; gap: 12px;">
                            <svg style="width: 24px; height: 24px; color: #3B82F6; flex-shrink: 0; margin-top: 2px;" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                            </svg>
                            <div>
                                <p style="color: #1E40AF; font-weight: 600; font-size: 14px; margin-bottom: 4px;">
                                    The supervisor's signature confirms that all safety measures have been reviewed and approved for the entire team.
                                </p>
                                <p style="color: #1E40AF; font-size: 13px; font-family: Arial; direction: rtl;">
                                                              
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer with Standardized Buttons -->
                <div class="page-footer">
                    <button class="btn-back" onclick="handlePage9Back()">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <button class="btn-next" onclick="handlePage9Complete()">
                        Next
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 10: PQC Supervisor Rating -->
        <div id="page10" class="page">
            <div class="page10-container">
                <!-- Header -->
                <div class="page10-header">
                    <h1>Remarks for PQC Supervisor</h1>
                    <p>PQC    </p>
                </div>

                <!-- Form Content -->
                <div class="form-content">
                    <!-- Error Banner -->
                    <div class="error-banner" id="error-banner-page10" style="margin-bottom: 16px;">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 24px; height: 24px; color: #EF4444; flex-shrink: 0;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <div style="margin-left: 12px; flex: 1;">
                            <p style="color: #EF4444; font-weight: 700; font-size: 14px; margin-bottom: 4px;">Please select a rating option</p>
                            <p style="color: #EF4444; font-weight: 700; font-size: 14px; font-family: Arial; direction: rtl;">     </p>
                        </div>
                    </div>

                    <!-- PQC Not Required Notice -->
                    <div class="pqc-disabled-notice" id="pqc-disabled-notice" style="display: none;">
                        <p>PQC Supervisor Not Required</p>
                        <p class="urdu">PQC    </p>
                    </div>

                    <!-- Rating Card -->
                    <div class="pqc-rating-card" id="pqc-rating-card">
                        <div class="pqc-question">
                            <p class="urdu">PQC                </p>
                            <p class="english">How well is the PQC Supervisor aware of the hazards related to the work and their control measures?</p>
                            <p class="error-text" id="rating-error" style="display: none;"> Required / </p>
                        </div>

                        <div class="rating-options">
                            <!-- Good Option -->
                            <button class="rating-btn" id="rating-good" onclick="selectRating('good')">
                                <span class="rating-btn-text">  / Good</span>
                                <div class="rating-checkbox">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                            </button>

                            <!-- Satisfactory Option -->
                            <button class="rating-btn" id="rating-satisfactory" onclick="selectRating('satisfactory')">
                                <span class="rating-btn-text">   / Satisfactory</span>
                                <div class="rating-checkbox">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                            </button>

                            <!-- Needs Improvement Option -->
                            <button class="rating-btn" id="rating-needs_improvement" onclick="selectRating('needs_improvement')">
                                <span class="rating-btn-text">    / Needs Improvement</span>
                                <div class="rating-checkbox">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Info Note -->
                    <div class="pqc-info-note" id="pqc-info-note">
                        <p> Please select one option to proceed</p>
                        <p class="urdu">       </p>
                    </div>
                </div>

                <!-- Footer -->
                <div class="page-footer">
                    <button class="btn-back" onclick="handlePage10Back()">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back
                    </button>
                    <button class="btn-next" onclick="handlePage10Next()">
                        Complete Form
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 11: Form Completion -->
        <div id="page11" class="page">
            <div class="completion-card">
                <!-- Success Header - Simplified -->
                <div class="completion-header" style="background: #FFFFFF; padding: 48px 24px;">
                    <h1 class="completion-title" style="color: #22C55E; text-shadow: none; font-size: 32px; margin-top: 0;">Form Successfully Submitted!</h1>
                    <p class="tric-id" style="color: var(--color-text); font-size: 16px; margin-top: 8px;" id="tric-id-display">TRIC ID: Loading...</p>
                </div>

                <!-- Content -->
                <div class="completion-content">
                    <!-- Urdu Messages -->
                    <div class="urdu-message-box">
                        <p>     </p>
                        <div class="divider"></div>
                        <p>              </p>
                        <div class="divider"></div>
                        <p>        </p>
                    </div>

                    <!-- Download Button - Simplified -->
                    <button class="download-btn" onclick="downloadPDF()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        <div class="download-btn-text">
                            <p>Download TRIC</p>
                            <p class="sub">TRIC   </p>
                        </div>
                    </button>

                    <div class="button-group">
                        <button class="btn-secondary" onclick="goToPage(10)">
                            <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                            <span>Back</span>
                        </button>
                        <button class="btn-home" onclick="goToPage(1)">
                            <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                            </svg>
                            <span>Home</span>
                        </button>
                    </div>
                </div>

                <!-- Footer -->
                <div class="completion-footer">
                    <p>Developed by Shahbaz Anwar AM CHSEQ</p>
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        <p>Form Saved</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- More pages will be added here... -->
    </div>

    <script>
        // =====================
        // TRIC FORM APPLICATION
        // =====================

        // Local Storage Key
        const STORAGE_KEY = 'tricFormData';
        const SAVED_FORMS_KEY = 'tricSavedForms';

        // Initialize form data
        let formData = loadFormData();

        // ===============
        // DATA MANAGEMENT
        // ===============

        function loadFormData() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    return JSON.parse(stored);
                } catch (e) {
                    console.error('Error loading form data:', e);
                    return {};
                }
            }
            return {};
        }

        function saveFormData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(formData));
                console.log('Form data saved:', formData);
            } catch (e) {
                console.error('Error saving form data:', e);
            }
        }

        function updateFormField(fieldName, value) {
            formData[fieldName] = value;
            saveFormData();
        }

        function clearFormData() {
            formData = {};
            localStorage.removeItem(STORAGE_KEY);
            console.log('Form data cleared');
        }

        function saveCompletedForm() {
            // Save the current form to saved forms list
            const savedForms = loadSavedForms();
            const timestamp = new Date().toISOString();
            
            savedForms.push({
                id: timestamp,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                data: { ...formData }
            });
            
            localStorage.setItem(SAVED_FORMS_KEY, JSON.stringify(savedForms));
            console.log('Form saved to completed forms');
        }

        function loadSavedForms() {
            const stored = localStorage.getItem(SAVED_FORMS_KEY);
            if (stored) {
                try {
                    return JSON.parse(stored);
                } catch (e) {
                    console.error('Error loading saved forms:', e);
                    return [];
                }
            }
            return [];
        }

        // ===========
        // NAVIGATION
        // ===========

        function goToPage(pageNumber) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // Show target page
            const targetPage = document.getElementById('page' + pageNumber);
            if (targetPage) {
                targetPage.classList.add('active');
                console.log('Navigated to page', pageNumber);
                
                // Page-specific initialization
                if (pageNumber === 2) {
                    restorePage2Data();
                    updateDateTime();
                    // Update time every second while on page 2
                    if (window.dateTimeInterval) {
                        clearInterval(window.dateTimeInterval);
                    }
                    window.dateTimeInterval = setInterval(updateDateTime, 1000);
                } else if (pageNumber === 3) {
                    // Clear interval when leaving page 2
                    if (window.dateTimeInterval) {
                        clearInterval(window.dateTimeInterval);
                    }
                    restorePage3Data();
                } else if (pageNumber === 4) {
                    initializeTools();
                    renderTools();
                } else if (pageNumber === 5) {
                    initializePPE();
                    renderPPE();
                } else if (pageNumber === 6) {
                    initializeInstructions();
                    renderInstructions();
                } else if (pageNumber === 7) {
                    initializeHazards();
                    renderHazards();
                } else if (pageNumber === 8) {
                    initializeConversation();
                    renderConversationPoints();
                } else if (pageNumber === 9) {
                    initializeSignatures();
                    renderSignatures();
                } else if (pageNumber === 10) {
                    initializePQCRating();
                    renderPQCPage();
                } else {
                    // Clear interval when leaving page 2
                    if (window.dateTimeInterval) {
                        clearInterval(window.dateTimeInterval);
                    }
                }
                
                // Scroll to top
                window.scrollTo(0, 0);
            } else {
                console.error('Page not found:', pageNumber);
            }
        }

        // ============================================
        // PAGE 1 ACTIONS
        // ============================================

        function startNewForm() {
            console.log('Starting new TRIC form...');
            
            // Clear any existing form data
            clearFormData();
            
            // Initialize form with timestamp
            formData.startedAt = new Date().toISOString();
            saveFormData();
            
            // Navigate to Page 2
            goToPage(2);
        }

        function viewSavedForms() {
            const savedForms = loadSavedForms();
            
            if (savedForms.length === 0) {
                alert('No saved forms found.\n\nComplete and save a form first.');
                return;
            }
            
            // Display saved forms
            let message = 'SAVED TRIC FORMS:\n\n';
            savedForms.forEach((form, index) => {
                message += `${index + 1}. ${form.date} at ${form.time}\n`;
            });
            
            alert(message);
            
            // TODO: Create a dedicated page for viewing/managing saved forms
        }

        // ============================================
        // AUTO-SAVE FUNCTIONALITY
        // ============================================

        // Auto-save input changes
        function setupAutoSave() {
            document.addEventListener('input', function(e) {
                if (e.target.tagName === 'INPUT' || 
                    e.target.tagName === 'TEXTAREA' || 
                    e.target.tagName === 'SELECT') {
                    
                    const fieldName = e.target.name || e.target.id;
                    if (fieldName) {
                        updateFormField(fieldName, e.target.value);
                    }
                }
            });
            
            // Auto-save checkbox changes
            document.addEventListener('change', function(e) {
                if (e.target.type === 'checkbox' || e.target.type === 'radio') {
                    const fieldName = e.target.name || e.target.id;
                    if (fieldName) {
                        if (e.target.type === 'checkbox') {
                            updateFormField(fieldName, e.target.checked);
                        } else {
                            updateFormField(fieldName, e.target.value);
                        }
                    }
                }
            });
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            console.log('TRIC Form Application Loaded');
            console.log('Current form data:', formData);
            
            // Setup auto-save
            setupAutoSave();
            
            // Check if there's existing form data
            if (Object.keys(formData).length > 0 && formData.startedAt) {
                const startedDate = new Date(formData.startedAt);
                console.log('Found existing form started at:', startedDate);
            }
        });

        // ============================================
        // PAGE 2 FUNCTIONS
        // ============================================

        // Generate TRIC ID
        function generateTRICId() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            return `TRIC-${year}${month}${day}-${hours}${minutes}${seconds}`;
        }

        // Update date, time, and TRIC ID
        function updateDateTime() {
            const dateEl = document.getElementById('date');
            const timeEl = document.getElementById('time');
            const tricIdEl = document.getElementById('tricId');
            
            if (dateEl && timeEl && tricIdEl) {
                const now = new Date();
                dateEl.textContent = now.toISOString().split('T')[0];
                timeEl.textContent = now.toTimeString().slice(0, 5);
                
                // Generate TRIC ID only once when form starts
                if (!formData.tricId) {
                    formData.tricId = generateTRICId();
                    saveFormData();
                }
                tricIdEl.textContent = formData.tricId;
            }
        }

        // Handle PTW selection
        function handlePTWChange(status) {
            formData.ptwStatus = status;
            saveFormData();
            
            const yesBtn = document.getElementById('ptw-yes');
            const noBtn = document.getElementById('ptw-no');
            const input = document.getElementById('ptwNo');
            
            yesBtn.classList.remove('active-yes');
            noBtn.classList.remove('active-no');
            
            if (status === 'yes') {
                yesBtn.classList.add('active-yes');
                input.disabled = false;
            } else {
                noBtn.classList.add('active-no');
                input.disabled = true;
                input.value = '';
                formData.ptwNo = '';
                saveFormData();
            }
            
            clearError('ptwStatus');
            clearError('ptwNo');
        }

        // Handle LOTO selection
        function handleLOTOChange(status) {
            formData.lotoStatus = status;
            saveFormData();
            
            const yesBtn = document.getElementById('loto-yes');
            const noBtn = document.getElementById('loto-no');
            const input = document.getElementById('lotoNo');
            
            yesBtn.classList.remove('active-yes');
            noBtn.classList.remove('active-no');
            
            if (status === 'yes') {
                yesBtn.classList.add('active-yes');
                input.disabled = false;
            } else {
                noBtn.classList.add('active-no');
                input.disabled = true;
                input.value = '';
                formData.lotoNo = '';
                saveFormData();
            }
            
            clearError('lotoStatus');
            clearError('lotoNo');
        }

        // Clear error
        function clearError(fieldId) {
            const errorElement = document.getElementById('error-' + fieldId);
            const inputElement = document.getElementById(fieldId);
            const section = fieldId.includes('ptw') ? document.getElementById('ptw-section') : 
                           fieldId.includes('loto') ? document.getElementById('loto-section') : null;
            
            if (errorElement) errorElement.style.display = 'none';
            if (inputElement) inputElement.classList.remove('error');
            if (section) section.classList.remove('error');
        }

        // Show error
        function showError(fieldId) {
            const errorElement = document.getElementById('error-' + fieldId);
            const inputElement = document.getElementById(fieldId);
            const section = fieldId.includes('ptw') ? document.getElementById('ptw-section') : 
                           fieldId.includes('loto') ? document.getElementById('loto-section') : null;
            
            if (errorElement) errorElement.style.display = 'block';
            if (inputElement) inputElement.classList.add('error');
            if (section) section.classList.add('error');
        }

        // Restore Page 2 form data
        function restorePage2Data() {
            const fields = ['bu', 'region', 'clusterZone', 'ibc', 'deptSection', 'subDept', 'mtlNo', 'jobLocation', 'workDetails', 'ptwNo', 'lotoNo'];
            
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element && formData[field]) {
                    element.value = formData[field];
                }
            });
            
            // Restore PTW status
            if (formData.ptwStatus) {
                handlePTWChange(formData.ptwStatus);
            }
            
            // Restore LOTO status
            if (formData.lotoStatus) {
                handleLOTOChange(formData.lotoStatus);
            }
        }

        // Handle Page 2 Back button
        function handlePage2Back() {
            goToPage(1);
        }

        // Handle Page 2 Next button (with validation)
        function handlePage2Next() {
            let hasErrors = false;
            
            // Required fields
            const requiredFields = ['bu', 'region', 'clusterZone', 'ibc', 'deptSection', 'subDept', 'mtlNo', 'jobLocation', 'workDetails'];
            
            // Validate all required fields
            requiredFields.forEach(field => {
                const element = document.getElementById(field);
                if (element && !element.value.trim()) {
                    showError(field);
                    hasErrors = true;
                }
            });
            
            // Validate PTW status
            if (!formData.ptwStatus) {
                showError('ptwStatus');
                hasErrors = true;
            } else if (formData.ptwStatus === 'yes') {
                const ptwNoElement = document.getElementById('ptwNo');
                if (!ptwNoElement.value.trim()) {
                    showError('ptwNo');
                    hasErrors = true;
                }
            }
            
            // Validate LOTO status
            if (!formData.lotoStatus) {
                showError('lotoStatus');
                hasErrors = true;
            } else if (formData.lotoStatus === 'yes') {
                const lotoNoElement = document.getElementById('lotoNo');
                if (!lotoNoElement.value.trim()) {
                    showError('lotoNo');
                    hasErrors = true;
                }
            }
            
            if (hasErrors) {
                const formContent = document.querySelector('.form-content');
                if (formContent) {
                    formContent.scrollTo({ top: 0, behavior: 'smooth' });
                }
                return;
            }
            
            console.log('Page 2 validated successfully!');
            // Navigate to Page 3
            goToPage(3);
        }

        // ============================================
        // PAGE 3 FUNCTIONS (Team Members)
        // ============================================

        function handlePQCChange(status) {
            formData.pqcRequired = status;
            saveFormData();
            
            const yesBtn = document.getElementById('pqc-yes');
            const noBtn = document.getElementById('pqc-no');
            const fields = document.getElementById('pqc-fields');
            
            yesBtn.classList.remove('active-yes');
            noBtn.classList.remove('active-no');
            
            if (status === 'yes') {
                yesBtn.classList.add('active-yes');
                fields.style.display = 'block';
            } else {
                noBtn.classList.add('active-no');
                fields.style.display = 'none';
                document.getElementById('pqc-name').value = '';
                document.getElementById('pqc-empid').value = '';
                formData.pqcName = '';
                formData.pqcEmpId = '';
                saveFormData();
            }
            
            clearError('pqc');
        }

        function addMember() {
            if (!formData.additionalMembers) {
                formData.additionalMembers = [];
            }
            
            const index = formData.additionalMembers.length;
            formData.additionalMembers.push({ name: '', empId: '' });
            saveFormData();
            
            const container = document.getElementById('additional-members');
            const card = document.createElement('div');
            card.className = 'member-card';
            card.id = `additional-${index}`;
            card.innerHTML = `
                <button class="remove-btn" onclick="removeMember(${index})"></button>
                <p style="font-weight: 600; color: var(--color-primary); margin-bottom: 12px; font-size: 14px;">
                    Additional Member ${index + 1}
                </p>
                <div class="form-group">
                    <label>Member Name: <span class="label-urdu">  </span></label>
                    <input type="text" class="form-input" id="additional-name-${index}" name="additional-name-${index}" placeholder="Enter member name" onchange="updateAdditionalMember(${index}, 'name', this.value)">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Emp. ID/CNIC: <span class="label-urdu"> / </span></label>
                    <input type="text" class="form-input" id="additional-empid-${index}" name="additional-empid-${index}" placeholder="Enter employee ID or CNIC" onchange="updateAdditionalMember(${index}, 'empId', this.value)">
                </div>
            `;
            container.appendChild(card);
        }

        function removeMember(index) {
            const card = document.getElementById(`additional-${index}`);
            if (card) card.remove();
            
            if (formData.additionalMembers) {
                formData.additionalMembers.splice(index, 1);
                saveFormData();
            }
        }

        function updateAdditionalMember(index, field, value) {
            if (formData.additionalMembers && formData.additionalMembers[index]) {
                formData.additionalMembers[index][field] = value;
                saveFormData();
            }
        }

        function restorePage3Data() {
            // Restore supervisor
            const supervisorName = document.getElementById('supervisor-name');
            const supervisorEmpId = document.getElementById('supervisor-empid');
            if (supervisorName && formData.supervisorName) supervisorName.value = formData.supervisorName;
            if (supervisorEmpId && formData.supervisorEmpId) supervisorEmpId.value = formData.supervisorEmpId;
            
            // Restore PQC
            if (formData.pqcRequired) {
                handlePQCChange(formData.pqcRequired);
                const pqcName = document.getElementById('pqc-name');
                const pqcEmpId = document.getElementById('pqc-empid');
                if (pqcName && formData.pqcName) pqcName.value = formData.pqcName;
                if (pqcEmpId && formData.pqcEmpId) pqcEmpId.value = formData.pqcEmpId;
            }
            
            // Restore team member
            const memberName = document.getElementById('member-name');
            const memberEmpId = document.getElementById('member-empid');
            if (memberName && formData.memberName) memberName.value = formData.memberName;
            if (memberEmpId && formData.memberEmpId) memberEmpId.value = formData.memberEmpId;
            
            // Restore additional members
            if (formData.additionalMembers && formData.additionalMembers.length > 0) {
                const container = document.getElementById('additional-members');
                container.innerHTML = '';
                formData.additionalMembers.forEach((member, index) => {
                    const card = document.createElement('div');
                    card.className = 'member-card';
                    card.id = `additional-${index}`;
                    card.innerHTML = `
                        <button class="remove-btn" onclick="removeMember(${index})"></button>
                        <p style="font-weight: 600; color: var(--color-primary); margin-bottom: 12px; font-size: 14px;">
                            Additional Member ${index + 1}
                        </p>
                        <div class="form-group">
                            <label>Member Name: <span class="label-urdu">  </span></label>
                            <input type="text" class="form-input" id="additional-name-${index}" name="additional-name-${index}" value="${member.name || ''}" placeholder="Enter member name" onchange="updateAdditionalMember(${index}, 'name', this.value)">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Emp. ID/CNIC: <span class="label-urdu"> / </span></label>
                            <input type="text" class="form-input" id="additional-empid-${index}" name="additional-empid-${index}" value="${member.empId || ''}" placeholder="Enter employee ID or CNIC" onchange="updateAdditionalMember(${index}, 'empId', this.value)">
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
        }

        function handlePage3Back() {
            goToPage(2);
        }

        function handlePage3Next() {
            let hasErrors = false;
            
            // Get values from inputs
            const supervisorName = document.getElementById('supervisor-name').value.trim();
            const supervisorEmpId = document.getElementById('supervisor-empid').value.trim();
            const pqcName = document.getElementById('pqc-name').value.trim();
            const pqcEmpId = document.getElementById('pqc-empid').value.trim();
            const memberName = document.getElementById('member-name').value.trim();
            const memberEmpId = document.getElementById('member-empid').value.trim();
            
            // Validate supervisor
            if (!supervisorName) {
                showError('supervisor-name');
                showError('supervisor');
                hasErrors = true;
            }
            if (!supervisorEmpId) {
                showError('supervisor-empid');
                showError('supervisor');
                hasErrors = true;
            }
            
            // Validate PQC
            if (!formData.pqcRequired) {
                showError('pqc');
                hasErrors = true;
            } else if (formData.pqcRequired === 'yes') {
                if (!pqcName) {
                    showError('pqc-name');
                    showError('pqc');
                    hasErrors = true;
                }
                if (!pqcEmpId) {
                    showError('pqc-empid');
                    showError('pqc');
                    hasErrors = true;
                }
            }
            
            // Validate team member
            if (!memberName) {
                showError('member-name');
                showError('member');
                hasErrors = true;
            }
            if (!memberEmpId) {
                showError('member-empid');
                showError('member');
                hasErrors = true;
            }
            
            if (hasErrors) {
                const formContent = document.querySelector('.form-content');
                if (formContent) {
                    formContent.scrollTo({ top: 0, behavior: 'smooth' });
                }
                return;
            }
            
            // Save all data to formData
            formData.supervisorName = supervisorName;
            formData.supervisorEmpId = supervisorEmpId;
            formData.memberName = memberName;
            formData.memberEmpId = memberEmpId;
            
            if (formData.pqcRequired === 'yes') {
                formData.pqcName = pqcName;
                formData.pqcEmpId = pqcEmpId;
            } else {
                // Clear PQC data if not required
                formData.pqcName = '';
                formData.pqcEmpId = '';
            }
            
            saveFormData();
            console.log('Page 3 data saved:', {
                supervisor: formData.supervisorName + ' - ' + formData.supervisorEmpId,
                member: formData.memberName + ' - ' + formData.memberEmpId,
                pqc: formData.pqcRequired === 'yes' ? formData.pqcName + ' - ' + formData.pqcEmpId : 'Not required'
            });
            
            goToPage(4);
        }

        // ============================================
        // PAGE 4 FUNCTIONS (Tools Requirements)
        // ============================================

        const defaultTools = [
            { english: 'Screwdriver', urdu: ' ' },
            { english: 'Hammer', urdu: '' },
            { english: 'Plyer', urdu: '' },
            { english: 'Cable cutter', urdu: ' ' },
            { english: 'Torch gas cylinder', urdu: '  ' },
            { english: 'Hot stick', urdu: ' ' },
            { english: 'Welding Plant', urdu: ' ' },
            { english: 'Test Lamp', urdu: ' ' },
            { english: 'Ranch', urdu: '' },
            { english: 'Spanner', urdu: '' },
            { english: 'Drill Machine', urdu: ' ' },
            { english: 'Grinder/Cutter', urdu: '/' },
            { english: 'Discharge rode', urdu: ' ' },
            { english: 'Short & Ground', urdu: '  ' }
        ];

        function initializeTools() {
            if (!formData.tools) {
                formData.tools = defaultTools.map(t => ({ ...t, status: '', isDefault: true }));
                saveFormData();
            }
        }

        function renderTools() {
            const grid = document.getElementById('tools-grid');
            if (!grid) return;
            
            grid.innerHTML = '';

            if (!formData.tools) {
                initializeTools();
            }

            formData.tools.forEach((tool, index) => {
                const card = document.createElement('div');
                card.className = 'tool-card';
                if (!tool.isDefault) card.classList.add('removable');
                card.id = `tool-${index}`;

                card.innerHTML = `
                    ${!tool.isDefault ? `<button class="remove-btn" onclick="removeTool(${index})"></button>` : ''}
                    <div class="tool-name">${tool.english}</div>
                    <div class="tool-name-urdu">${tool.urdu}</div>
                    <div class="tool-error" id="error-tool-${index}" style="display: none;"> Required<br></div>
                    <div class="tool-buttons">
                        <button class="tool-btn" id="btn-${index}-available" onclick="setToolStatus(${index}, 'available')" title="Available">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                            </svg>
                        </button>
                        <button class="tool-btn" id="btn-${index}-not-available" onclick="setToolStatus(${index}, 'not-available')" title="Not Available">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                        <button class="tool-btn" id="btn-${index}-na" onclick="setToolStatus(${index}, 'na')" title="Not Applicable">N/A</button>
                    </div>
                `;

                grid.appendChild(card);

                // Apply current status
                if (tool.status) {
                    updateToolButtonState(index, tool.status);
                }
            });
        }

        function setToolStatus(index, status) {
            if (!formData.tools) initializeTools();
            formData.tools[index].status = status;
            saveFormData();
            updateToolButtonState(index, status);
            clearToolError(index);
        }

        function updateToolButtonState(index, status) {
            const btns = ['available', 'not-available', 'na'];
            btns.forEach(btn => {
                const el = document.getElementById(`btn-${index}-${btn}`);
                if (el) {
                    el.classList.remove('active-available', 'active-not-available', 'active-na');
                }
            });

            const activeBtn = document.getElementById(`btn-${index}-${status}`);
            if (activeBtn) {
                activeBtn.classList.add(`active-${status}`);
            }
        }

        function clearToolError(index) {
            const card = document.getElementById(`tool-${index}`);
            const error = document.getElementById(`error-tool-${index}`);
            if (card) card.classList.remove('error');
            if (error) error.style.display = 'none';
        }

        function showToolError(index) {
            const card = document.getElementById(`tool-${index}`);
            const error = document.getElementById(`error-tool-${index}`);
            if (card) card.classList.add('error');
            if (error) error.style.display = 'block';
        }

        function addTool() {
            const input = document.getElementById('new-tool');
            const name = input.value.trim();
            if (!name) return;

            if (!formData.tools) initializeTools();
            
            formData.tools.push({
                english: name,
                urdu: name,
                status: '',
                isDefault: false
            });

            input.value = '';
            saveFormData();
            renderTools();
        }

        function removeTool(index) {
            if (!formData.tools) return;
            formData.tools.splice(index, 1);
            saveFormData();
            renderTools();
        }

        function handlePage4Back() {
            goToPage(3);
        }

        function handlePage4Next() {
            if (!formData.tools) initializeTools();
            
            let hasErrors = false;
            const banner = document.getElementById('error-banner-tools');

            formData.tools.forEach((tool, index) => {
                if (!tool.status) {
                    showToolError(index);
                    hasErrors = true;
                }
            });

            if (hasErrors) {
                if (banner) banner.classList.add('show');
                const formContent = document.querySelector('.form-content');
                if (formContent) {
                    formContent.scrollTo({ top: 0, behavior: 'smooth' });
                }
            } else {
                if (banner) banner.classList.remove('show');
                console.log('Page 4 validated successfully!', formData.tools);
                goToPage(5);
            }
        }

        // ============================================
        // PAGE 5 FUNCTIONS (PPE Requirements)
        // ============================================

        const defaultPPE = [
            { english: 'Safety Helmet with chin strap', urdu: '    ' },
            { english: 'Leather gloves', urdu: '  ' },
            { english: 'Full body harness', urdu: '  ' },
            { english: 'Anti flash hood', urdu: '  ' },
            { english: 'Safety Shoes', urdu: ' ' },
            { english: 'Fluorescent Jacket', urdu: ' ' },
            { english: 'Test Lamp', urdu: ' ' },
            { english: 'Rubber gloves LT/HT', urdu: '   LT/HT' },
            { english: 'Working gloves', urdu: ' ' },
            { english: 'Face shield', urdu: ' ' }
        ];

        function initializePPE() {
            if (!formData.ppe) {
                formData.ppe = defaultPPE.map(p => ({ ...p, status: '', isDefault: true }));
                saveFormData();
            }
        }

        function renderPPE() {
            const grid = document.getElementById('ppe-grid');
            if (!grid) return;
            
            grid.innerHTML = '';

            if (!formData.ppe) {
                initializePPE();
            }

            formData.ppe.forEach((ppe, index) => {
                const card = document.createElement('div');
                card.className = 'ppe-card';
                if (!ppe.isDefault) card.classList.add('removable');
                card.id = `ppe-${index}`;

                card.innerHTML = `
                    ${!ppe.isDefault ? `<button class="remove-btn" onclick="removePPE(${index})"></button>` : ''}
                    <div class="ppe-name">${ppe.english}</div>
                    <div class="ppe-name-urdu">${ppe.urdu}</div>
                    <div class="ppe-error" id="error-ppe-${index}" style="display: none;"> Required<br></div>
                    <div class="ppe-buttons">
                        <button class="ppe-btn" id="btn-ppe-${index}-available" onclick="setPPEStatus(${index}, 'available')" title="Available"></button>
                        <button class="ppe-btn" id="btn-ppe-${index}-not-available" onclick="setPPEStatus(${index}, 'not-available')" title="Not Available"></button>
                        <button class="ppe-btn" id="btn-ppe-${index}-na" onclick="setPPEStatus(${index}, 'na')" title="Not Applicable">N/A</button>
                    </div>
                `;

                grid.appendChild(card);

                // Apply current status
                if (ppe.status) {
                    updatePPEButtonState(index, ppe.status);
                }
            });
        }

        function setPPEStatus(index, status) {
            if (!formData.ppe) initializePPE();
            formData.ppe[index].status = status;
            saveFormData();
            updatePPEButtonState(index, status);
            clearPPEError(index);
        }

        function updatePPEButtonState(index, status) {
            const btns = ['available', 'not-available', 'na'];
            btns.forEach(btn => {
                const el = document.getElementById(`btn-ppe-${index}-${btn}`);
                if (el) {
                    el.classList.remove('active-available', 'active-not-available', 'active-na');
                }
            });

            const activeBtn = document.getElementById(`btn-ppe-${index}-${status}`);
            if (activeBtn) {
                activeBtn.classList.add(`active-${status}`);
            }
        }

        function clearPPEError(index) {
            const card = document.getElementById(`ppe-${index}`);
            const error = document.getElementById(`error-ppe-${index}`);
            if (card) card.classList.remove('error');
            if (error) error.style.display = 'none';
        }

        function showPPEError(index) {
            const card = document.getElementById(`ppe-${index}`);
            const error = document.getElementById(`error-ppe-${index}`);
            if (card) card.classList.add('error');
            if (error) error.style.display = 'block';
        }

        function addPPE() {
            const input = document.getElementById('new-ppe');
            const name = input.value.trim();
            if (!name) return;

            if (!formData.ppe) initializePPE();
            
            formData.ppe.push({
                english: name,
                urdu: name,
                status: '',
                isDefault: false
            });

            input.value = '';
            saveFormData();
            renderPPE();
        }

        function removePPE(index) {
            if (!formData.ppe) return;
            formData.ppe.splice(index, 1);
            saveFormData();
            renderPPE();
        }

        function handlePage5Back() {
            goToPage(4);
        }

        function handlePage5Next() {
            if (!formData.ppe) initializePPE();
            
            let hasErrors = false;
            const banner = document.getElementById('error-banner-ppe');

            formData.ppe.forEach((ppe, index) => {
                if (!ppe.status) {
                    showPPEError(index);
                    hasErrors = true;
                }
            });

            if (hasErrors) {
                if (banner) banner.classList.add('show');
                const formContent = document.querySelector('#page5 .form-content');
                if (formContent) {
                    formContent.scrollTo({ top: 0, behavior: 'smooth' });
                }
            } else {
                if (banner) banner.classList.remove('show');
                console.log('Page 5 validated successfully!', formData.ppe);
                goToPage(6);
            }
        }

        // ============================================
        // PAGE 6 FUNCTIONS (Necessary Instructions)
        // ============================================

        const instructions = [
            {
                urdu: "   SOP        PMT/SS/RMU/KS/LBS          ",
                english: "Have all identified isolation points PMT/SS/RMU/KS/LBS and other connected feeders been closed as per the Line Isolation SOP?"
            },
            {
                urdu: "   AOC      ",
                english: "Are all operations performed with AOC coordination?"
            },
            {
                urdu: "              ",
                english: "Has the supervisor confirmed the absence of supply with a line tester?"
            },
            {
                urdu: "      ",
                english: "Have the system/equipment be grounded and shorted for this operation?"
            },
            {
                urdu: "        ",
                english: "Is the far end grounded and shorted?"
            },
            {
                urdu: "        ",
                english: "Is the far end grounded and shorted?"
            },
            {
                urdu: "  LT        ",
                english: "Have all the LT circuits and street lights been turned off?"
            },
            {
                urdu: "  LT       ",
                english: "Are all closed LT circuits grounded and shorted?"
            },
            {
                urdu: " PTW       ",
                english: "Did PTW exchange with the concerned supervisor?"
            },
            {
                urdu: "   /                    ",
                english: "Has the lineman/fitter jointer verified the absence of supply and ground and short with a live line tester?"
            },
            {
                urdu: " Portable ladder                ",
                english: "If the use of a portable ladder is necessary, have you ensured its usable condition?"
            }
        ];

        function initializeInstructions() {
            if (!formData.instructions) {
                formData.instructions = instructions.map(() => ({ status: '' }));
                saveFormData();
            }
        }

        function renderInstructions() {
            const container = document.getElementById('instructions-container');
            if (!container) return;
            
            container.innerHTML = '';

            if (!formData.instructions) {
                initializeInstructions();
            }

            instructions.forEach((instruction, index) => {
                const card = document.createElement('div');
                card.className = 'instruction-card';
                card.id = `instruction-${index}`;

                card.innerHTML = `
                    <p class="urdu-text">${instruction.urdu}</p>
                    <p class="english-text">${instruction.english}</p>
                    <div class="instruction-error" id="error-instruction-${index}"> Required / </div>
                    <div class="button-group">
                        <button class="status-btn" id="yes-${index}" onclick="setInstructionStatus(${index}, 'yes')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                            </svg>
                            <span>Yes / </span>
                        </button>
                        <button class="status-btn" id="no-${index}" onclick="setInstructionStatus(${index}, 'no')">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                            <span>No / </span>
                        </button>
                    </div>
                `;

                container.appendChild(card);

                // Restore status if exists
                if (formData.instructions[index] && formData.instructions[index].status) {
                    updateInstructionButtonState(index, formData.instructions[index].status);
                }
            });
        }

        function setInstructionStatus(index, status) {
            if (!formData.instructions) initializeInstructions();
            formData.instructions[index].status = status;
            saveFormData();

            updateInstructionButtonState(index, status);
            clearInstructionError(index);
        }

        function updateInstructionButtonState(index, status) {
            const yesBtn = document.getElementById(`yes-${index}`);
            const noBtn = document.getElementById(`no-${index}`);

            if (yesBtn && noBtn) {
                // Remove active class from both
                yesBtn.classList.remove('active-yes', 'active-no');
                noBtn.classList.remove('active-yes', 'active-no');

                // Add active to selected
                if (status === 'yes') {
                    yesBtn.classList.add('active-yes');
                } else {
                    noBtn.classList.add('active-no');
                }
            }
        }

        function clearInstructionError(index) {
            const card = document.getElementById(`instruction-${index}`);
            const errorMsg = document.getElementById(`error-instruction-${index}`);
            if (card) card.classList.remove('error');
            if (errorMsg) errorMsg.classList.remove('show');
        }

        function showInstructionError(index) {
            const card = document.getElementById(`instruction-${index}`);
            const errorMsg = document.getElementById(`error-instruction-${index}`);
            if (card) card.classList.add('error');
            if (errorMsg) errorMsg.classList.add('show');
        }

        function handlePage6Back() {
            goToPage(5);
        }

        function handlePage6Next() {
            if (!formData.instructions) initializeInstructions();

            // Clear all errors first
            document.querySelectorAll('.instruction-card').forEach(card => {
                card.classList.remove('error');
            });
            document.querySelectorAll('.instruction-error').forEach(msg => {
                msg.classList.remove('show');
            });

            // Validate all instructions
            let hasErrors = false;
            formData.instructions.forEach((response, index) => {
                if (!response.status) {
                    showInstructionError(index);
                    hasErrors = true;
                }
            });

            if (hasErrors) {
                const formContent = document.querySelector('#page6 .form-content');
                if (formContent) {
                    formContent.scrollTo({ top: 0, behavior: 'smooth' });
                }
                return;
            }

            console.log('Page 6 validated successfully!', formData.instructions);
            goToPage(7);
        }

        // ============================================
        // PAGE 7 FUNCTIONS (Hazards & Controls)
        // ============================================

        const hazardsData = [
            {
                titleUrdu: "/     ",
                titleEnglish: "Presence of electric current/Electric Arch",
                controls: [
                    { urdu: "     ", english: "Line isolation and rubber gloves" },
                    { urdu: "  /   ", english: "Face shield/anti-flash hood" }
                ]
            },
            {
                titleUrdu: "  /  ",
                titleEnglish: "Ineffective / Incorrect communication",
                controls: [
                    { urdu: "   AOC  OCR    ()  ", english: "Repeating communication between site supervisor, in-charge, AOC, and OCR" },
                    { urdu: "    ", english: "Reconfirmation of isolation point" }
                ]
            },
            {
                titleUrdu: "/  ",
                titleEnglish: "Fall/Fall from height",
                controls: [
                    { urdu: " ", english: "Safety harness" },
                    { urdu: " ", english: "Secure ladder" }
                ]
            },
            {
                titleUrdu: "  ",
                titleEnglish: "Traffic hazards",
                controls: [
                    { urdu: " ", english: "Safety cones" },
                    { urdu: " ", english: "Fluorescent jacket" }
                ]
            },
            {
                titleUrdu: "()   ",
                titleEnglish: "Injured (crushed) fingers and hands",
                controls: [
                    { urdu: "  ", english: "Use of gloves" },
                    { urdu: "   ", english: "Handling according to weight" },
                    { urdu: " ", english: "Manual handling" }
                ]
            },
            {
                titleUrdu: " /  ",
                titleEnglish: "Slip / Trip",
                controls: [
                    { urdu: " ", english: "Safety Shoes" }
                ]
            },
            {
                titleUrdu: "     /  ",
                titleEnglish: "Falling of tools/objects from height during work",
                controls: [
                    { urdu: "     ", english: "Safety helmet with chin strap" }
                ]
            },
            {
                titleUrdu: "  /       / ",
                titleEnglish: "Safe Parking / Striking an object or vehicle",
                controls: [
                    { urdu: "              ", english: "Restrict public access to the area by placing safety cones and safety tape." }
                ]
            },
            {
                titleUrdu: "   ",
                titleEnglish: "Public Hazards",
                controls: [
                    { urdu: "     ", english: "Falling from height during work" },
                    { urdu: "      / ", english: "Striking an object or vehicle" },
                    { urdu: "         ", english: "Inspect remaining components after completion of work" }
                ],
                specialControl: {
                    urdu: "                      ",
                    english: "If the pole is grounded, select tick mark, otherwise write Pole ID. Is HT line earth guard wire present?"
                },
                additionalControls: [
                    { urdu: "              ", english: "Restrict public access to the area by placing safety cones and safety tape." },
                    { urdu: "        ", english: "Place light indicators for night-time hazards." },
                    { urdu: "       /   ", english: "Clean the work site/area after completion of work." }
                ]
            }
        ];

        function initializeHazards() {
            if (!formData.hazards) {
                formData.hazards = hazardsData.map(() => ({
                    hazardStatus: '',
                    controls: [],
                    poleIdOption: '',
                    poleIdValue: ''
                }));
                formData.otherHazards = '';
                saveFormData();
            }
        }

        function renderHazards() {
            const container = document.getElementById('hazards-container');
            if (!container) return;
            
            if (!formData.hazards) initializeHazards();
            
            container.innerHTML = hazardsData.map((hazard, hazardIndex) => `
                <div class="hazard-card" id="hazard-${hazardIndex}">
                    <div class="hazard-header">
                        <div class="hazard-title">
                            <h3 class="urdu">${hazard.titleUrdu}</h3>
                            <p>${hazard.titleEnglish}</p>
                            <div class="error-text" id="error-hazard-${hazardIndex}" style="display: none;"> Required / </div>
                        </div>
                        <div class="hazard-buttons">
                            <button class="hazard-btn" id="hazard-yes-${hazardIndex}" onclick="handleHazardStatus(${hazardIndex}, 'yes')">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                </svg>
                            </button>
                            <button class="hazard-btn" id="hazard-no-${hazardIndex}" onclick="handleHazardStatus(${hazardIndex}, 'no')">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="controls-section" id="controls-${hazardIndex}">
                        <div class="controls-divider">
                            <div class="line"></div>
                            <span>Control Measures /  </span>
                            <div class="line"></div>
                        </div>
                        <div class="controls-list">
                            ${hazard.controls.map((control, controlIdx) => `
                                <div class="control-item" id="control-${hazardIndex}-${controlIdx}">
                                    <div class="control-text">
                                        <p class="urdu-text"> ${control.urdu}</p>
                                        <p class="english-text">${control.english}</p>
                                        <div class="error-text" id="error-control-${hazardIndex}-${controlIdx}" style="display: none;"> Required / </div>
                                    </div>
                                    <div class="control-buttons">
                                        <button class="control-btn" id="control-yes-${hazardIndex}-${controlIdx}" onclick="handleControlStatus(${hazardIndex}, ${controlIdx}, 'yes')">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                            </svg>
                                        </button>
                                        <button class="control-btn" id="control-no-${hazardIndex}-${controlIdx}" onclick="handleControlStatus(${hazardIndex}, ${controlIdx}, 'no')">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                            ${hazard.specialControl ? `
                                <div class="special-control" id="special-${hazardIndex}">
                                    <p class="special-control-label">${hazard.specialControl.urdu}</p>
                                    <p class="special-control-subtitle">${hazard.specialControl.english}</p>
                                    <div class="error-text" id="error-pole-${hazardIndex}" style="display: none;"> Required / </div>
                                    <div class="pole-options">
                                        <button class="pole-btn" id="pole-tick-${hazardIndex}" onclick="handlePoleOption(${hazardIndex}, 'tick')">
                                            <span> Pole is grounded</span>
                                        </button>
                                        <button class="pole-btn" id="pole-write-${hazardIndex}" onclick="handlePoleOption(${hazardIndex}, 'write')">
                                            <span>Write Pole ID</span>
                                        </button>
                                    </div>
                                    <input type="text" class="pole-input" id="pole-input-${hazardIndex}" 
                                        placeholder="Enter Pole ID..." 
                                        oninput="handlePoleInput(${hazardIndex})" disabled>
                                </div>
                            ` : ''}
                            ${hazard.additionalControls ? hazard.additionalControls.map((control, idx) => {
                                const controlIdx = hazard.controls.length + idx;
                                return `
                                <div class="control-item" id="control-${hazardIndex}-${controlIdx}">
                                    <div class="control-text">
                                        <p class="urdu-text"> ${control.urdu}</p>
                                        <p class="english-text">${control.english}</p>
                                        <div class="error-text" id="error-control-${hazardIndex}-${controlIdx}" style="display: none;"> Required / </div>
                                    </div>
                                    <div class="control-buttons">
                                        <button class="control-btn" id="control-yes-${hazardIndex}-${controlIdx}" onclick="handleControlStatus(${hazardIndex}, ${controlIdx}, 'yes')">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                            </svg>
                                        </button>
                                        <button class="control-btn" id="control-no-${hazardIndex}-${controlIdx}" onclick="handleControlStatus(${hazardIndex}, ${controlIdx}, 'no')">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>`;
                            }).join('') : ''}
                        </div>
                    </div>
                </div>
            `).join('');

            // Restore saved states
            restoreHazardsData();
        }

        function restoreHazardsData() {
            if (!formData.hazards) return;

            formData.hazards.forEach((response, hazardIndex) => {
                if (response.hazardStatus) {
                    updateHazardButtonState(hazardIndex, response.hazardStatus);
                    if (response.hazardStatus === 'yes') {
                        const controlsSection = document.getElementById(`controls-${hazardIndex}`);
                        if (controlsSection) controlsSection.classList.add('show');
                        
                        // Restore control states
                        response.controls.forEach((control, controlIdx) => {
                            if (control.status) {
                                updateControlButtonState(hazardIndex, controlIdx, control.status);
                            }
                        });
                        
                        // Restore pole option
                        if (response.poleIdOption) {
                            updatePoleOptionState(hazardIndex, response.poleIdOption, response.poleIdValue);
                        }
                    }
                }
            });

            // Restore other hazards
            const otherHazardsTextarea = document.getElementById('otherHazards');
            if (otherHazardsTextarea && formData.otherHazards) {
                otherHazardsTextarea.value = formData.otherHazards;
            }
        }

        function handleHazardStatus(hazardIndex, status) {
            if (!formData.hazards) initializeHazards();
            formData.hazards[hazardIndex].hazardStatus = status;
            
            if (status === 'no') {
                formData.hazards[hazardIndex].controls = [];
                formData.hazards[hazardIndex].poleIdOption = '';
                formData.hazards[hazardIndex].poleIdValue = '';
            }
            
            saveFormData();
            updateHazardButtonState(hazardIndex, status);
            
            const controlsSection = document.getElementById(`controls-${hazardIndex}`);
            const hazardCard = document.getElementById(`hazard-${hazardIndex}`);
            const errorText = document.getElementById(`error-hazard-${hazardIndex}`);
            
            if (hazardCard) hazardCard.classList.remove('error');
            if (errorText) errorText.style.display = 'none';
            
            if (status === 'yes' && controlsSection) {
                controlsSection.classList.add('show');
            } else if (controlsSection) {
                controlsSection.classList.remove('show');
            }
        }

        function updateHazardButtonState(hazardIndex, status) {
            const yesBtn = document.getElementById(`hazard-yes-${hazardIndex}`);
            const noBtn = document.getElementById(`hazard-no-${hazardIndex}`);
            
            if (yesBtn && noBtn) {
                yesBtn.classList.remove('active-yes');
                noBtn.classList.remove('active-no');
                
                if (status === 'yes') {
                    yesBtn.classList.add('active-yes');
                } else {
                    noBtn.classList.add('active-no');
                }
            }
        }

        function handleControlStatus(hazardIndex, controlIndex, status) {
            if (!formData.hazards) initializeHazards();
            if (!formData.hazards[hazardIndex].controls[controlIndex]) {
                formData.hazards[hazardIndex].controls[controlIndex] = {};
            }
            formData.hazards[hazardIndex].controls[controlIndex].status = status;
            saveFormData();
            
            updateControlButtonState(hazardIndex, controlIndex, status);
            
            const controlItem = document.getElementById(`control-${hazardIndex}-${controlIndex}`);
            const errorText = document.getElementById(`error-control-${hazardIndex}-${controlIndex}`);
            
            if (controlItem) controlItem.classList.remove('error');
            if (errorText) errorText.style.display = 'none';
        }

        function updateControlButtonState(hazardIndex, controlIndex, status) {
            const yesBtn = document.getElementById(`control-yes-${hazardIndex}-${controlIndex}`);
            const noBtn = document.getElementById(`control-no-${hazardIndex}-${controlIndex}`);
            
            if (yesBtn && noBtn) {
                yesBtn.classList.remove('active-yes');
                noBtn.classList.remove('active-no');
                
                if (status === 'yes') {
                    yesBtn.classList.add('active-yes');
                } else {
                    noBtn.classList.add('active-no');
                }
            }
        }

        function handlePoleOption(hazardIndex, option) {
            if (!formData.hazards) initializeHazards();
            formData.hazards[hazardIndex].poleIdOption = option;
            
            if (option === 'tick') {
                formData.hazards[hazardIndex].poleIdValue = '';
            }
            
            saveFormData();
            updatePoleOptionState(hazardIndex, option, formData.hazards[hazardIndex].poleIdValue);
        }

        function updatePoleOptionState(hazardIndex, option, value) {
            const tickBtn = document.getElementById(`pole-tick-${hazardIndex}`);
            const writeBtn = document.getElementById(`pole-write-${hazardIndex}`);
            const input = document.getElementById(`pole-input-${hazardIndex}`);
            const specialControl = document.getElementById(`special-${hazardIndex}`);
            const errorText = document.getElementById(`error-pole-${hazardIndex}`);
            
            if (tickBtn && writeBtn && input) {
                tickBtn.classList.remove('active');
                writeBtn.classList.remove('active');
                if (specialControl) specialControl.classList.remove('error');
                if (errorText) errorText.style.display = 'none';
                input.classList.remove('error');
                
                if (option === 'tick') {
                    tickBtn.classList.add('active');
                    input.disabled = true;
                    input.value = '';
                } else {
                    writeBtn.classList.add('active');
                    input.disabled = false;
                    if (value) input.value = value;
                }
            }
        }

        function handlePoleInput(hazardIndex) {
            const input = document.getElementById(`pole-input-${hazardIndex}`);
            if (!formData.hazards) initializeHazards();
            formData.hazards[hazardIndex].poleIdValue = input.value;
            saveFormData();
            
            if (input.value.trim()) {
                const specialControl = document.getElementById(`special-${hazardIndex}`);
                const errorText = document.getElementById(`error-pole-${hazardIndex}`);
                if (specialControl) specialControl.classList.remove('error');
                if (errorText) errorText.style.display = 'none';
                input.classList.remove('error');
            }
        }

        function handlePage7Back() {
            // Save other hazards before leaving
            const otherHazardsTextarea = document.getElementById('otherHazards');
            if (otherHazardsTextarea) {
                formData.otherHazards = otherHazardsTextarea.value;
                saveFormData();
            }
            goToPage(6);
        }

        function handlePage7Next() {
            if (!formData.hazards) initializeHazards();
            
            // Save other hazards
            const otherHazardsTextarea = document.getElementById('otherHazards');
            if (otherHazardsTextarea) {
                formData.otherHazards = otherHazardsTextarea.value;
                saveFormData();
            }
            
            const errors = {};
            
            formData.hazards.forEach((response, hazardIndex) => {
                const hazard = hazardsData[hazardIndex];
                const hazardCard = document.getElementById(`hazard-${hazardIndex}`);
                const errorText = document.getElementById(`error-hazard-${hazardIndex}`);
                
                if (!response.hazardStatus) {
                    errors[`hazard_${hazardIndex}`] = true;
                    if (hazardCard) hazardCard.classList.add('error');
                    if (errorText) errorText.style.display = 'block';
                } else {
                    if (hazardCard) hazardCard.classList.remove('error');
                    if (errorText) errorText.style.display = 'none';
                }
                
                if (response.hazardStatus === 'yes') {
                    const totalControls = hazard.controls.length + (hazard.additionalControls?.length || 0);
                    
                    for (let i = 0; i < totalControls; i++) {
                        const controlItem = document.getElementById(`control-${hazardIndex}-${i}`);
                        const controlError = document.getElementById(`error-control-${hazardIndex}-${i}`);
                        
                        if (!response.controls[i]?.status) {
                            errors[`control_${hazardIndex}_${i}`] = true;
                            if (controlItem) controlItem.classList.add('error');
                            if (controlError) controlError.style.display = 'block';
                        } else {
                            if (controlItem) controlItem.classList.remove('error');
                            if (controlError) controlError.style.display = 'none';
                        }
                    }
                    
                    if (hazard.specialControl) {
                        const specialControl = document.getElementById(`special-${hazardIndex}`);
                        const poleError = document.getElementById(`error-pole-${hazardIndex}`);
                        const poleInput = document.getElementById(`pole-input-${hazardIndex}`);
                        
                        if (!response.poleIdOption) {
                            errors[`pole_${hazardIndex}`] = true;
                            if (specialControl) specialControl.classList.add('error');
                            if (poleError) poleError.style.display = 'block';
                        } else if (response.poleIdOption === 'write' && !response.poleIdValue?.trim()) {
                            errors[`pole_${hazardIndex}`] = true;
                            if (specialControl) specialControl.classList.add('error');
                            if (poleError) poleError.style.display = 'block';
                            if (poleInput) poleInput.classList.add('error');
                        } else {
                            if (specialControl) specialControl.classList.remove('error');
                            if (poleError) poleError.style.display = 'none';
                            if (poleInput) poleInput.classList.remove('error');
                        }
                    }
                }
            });
            
            const errorBanner = document.getElementById('error-banner-hazards');
            if (Object.keys(errors).length > 0) {
                if (errorBanner) errorBanner.classList.add('show');
                const formContent = document.querySelector('#page7 .form-content');
                if (formContent) {
                    formContent.scrollTo({ top: 0, behavior: 'smooth' });
                }
                return;
            } else {
                if (errorBanner) errorBanner.classList.remove('show');
            }
            
            console.log('Page 7 validated successfully!', formData.hazards);
            goToPage(8);
        }

        // ============================================
        // PAGE 8 FUNCTIONS (Conversation with Team)
        // ============================================

        const conversationPoints = [
            {
                urdu: "      ",
                english: "What harm could you face?"
            },
            {
                urdu: "       ",
                english: "What will you do in case of an emergency during work?"
            },
            {
                urdu: "             ",
                english: "Have all personnel been informed about the work, hazards, controls, and their responsibilities?"
            },
            {
                urdu: " critical hazard risk assessment       ",
                english: "Have they been made aware of the relevant critical hazard risk assessment in the toolbox talk?"
            }
        ];

        function initializeConversation() {
            if (!formData.conversation) {
                formData.conversation = {
                    checks: [false, false, false, false],
                    oathAccepted: false
                };
                saveFormData();
            }
        }

        function renderConversationPoints() {
            const container = document.getElementById('conversation-points');
            if (!container) return;

            if (!formData.conversation) initializeConversation();

            container.innerHTML = conversationPoints.map((point, index) => `
                <div class="conversation-point ${formData.conversation.checks[index] ? 'checked' : ''}" id="conv-point-${index}">
                    <span class="point-number">${index + 1}</span>
                    <div class="point-text">
                        <p class="urdu">${point.urdu}</p>
                        <p class="english">${point.english}</p>
                        <p class="point-error" id="error-point-${index}" style="display: none;"> Required / </p>
                    </div>
                    <button type="button" class="checkbox-btn ${formData.conversation.checks[index] ? 'checked' : ''}" 
                            id="checkbox-${index}" 
                            onclick="toggleConversationCheck(${index}); return false;">
                        ${formData.conversation.checks[index] ? `
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                            </svg>
                        ` : ''}
                    </button>
                </div>
            `).join('');

            // Restore oath state
            if (formData.conversation.oathAccepted) {
                updateOathState(true);
            }
        }

        function toggleConversationCheck(index) {
            console.log('Toggle conversation check called for index:', index);
            
            if (!formData.conversation) {
                console.log('Initializing conversation data');
                initializeConversation();
            }
            
            // Toggle the check
            formData.conversation.checks[index] = !formData.conversation.checks[index];
            console.log('Check status for index', index, ':', formData.conversation.checks[index]);
            saveFormData();

            const checkbox = document.getElementById(`checkbox-${index}`);
            const point = document.getElementById(`conv-point-${index}`);
            const error = document.getElementById(`error-point-${index}`);

            if (!checkbox) {
                console.error('Checkbox not found for index:', index);
                return;
            }

            if (formData.conversation.checks[index]) {
                checkbox.classList.add('checked');
                checkbox.innerHTML = `
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                    </svg>
                `;
                if (point) point.classList.remove('error');
                if (error) error.style.display = 'none';
            } else {
                checkbox.classList.remove('checked');
                checkbox.innerHTML = '';
            }

            // Check if all are checked
            const allChecked = formData.conversation.checks.every(c => c === true);
            console.log('All checks status:', formData.conversation.checks, 'All checked:', allChecked);
            
            if (allChecked) {
                const section = document.getElementById('conversation-section');
                const badge = document.getElementById('conversation-error-badge');
                if (section) section.classList.remove('error');
                if (badge) badge.style.display = 'none';
                
                const errorText = document.getElementById('error-conversations-text');
                if (errorText) errorText.style.display = 'none';
                
                // Hide error banner if oath is also checked
                if (formData.conversation.oathAccepted) {
                    const banner = document.getElementById('error-banner-page8');
                    if (banner) banner.classList.remove('show');
                }
            }
        }

        function toggleOath() {
            if (!formData.conversation) initializeConversation();
            
            formData.conversation.oathAccepted = !formData.conversation.oathAccepted;
            saveFormData();

            updateOathState(formData.conversation.oathAccepted);

            // Clear errors if oath is accepted
            if (formData.conversation.oathAccepted) {
                const section = document.getElementById('oath-section');
                const badge = document.getElementById('oath-error-badge');
                if (section) section.classList.remove('error');
                if (badge) badge.style.display = 'none';
                
                const errorText = document.getElementById('error-oath-text');
                if (errorText) errorText.style.display = 'none';
                
                // Hide error banner if all conversations are also checked
                const allChecked = formData.conversation.checks.every(c => c === true);
                if (allChecked) {
                    const banner = document.getElementById('error-banner-page8');
                    if (banner) banner.classList.remove('show');
                }
            }
        }

        function updateOathState(isChecked) {
            const btn = document.getElementById('oath-btn');
            const checkbox = document.getElementById('oath-checkbox');
            const checkIcon = document.getElementById('oath-check-icon');
            const mainText = document.getElementById('oath-main-text');
            const subText = document.getElementById('oath-sub-text');
            const success = document.getElementById('oath-success');
            const section = document.getElementById('oath-section');

            if (isChecked) {
                btn.classList.add('checked');
                section.classList.add('checked');
                checkIcon.style.display = 'block';
                mainText.textContent = ' Oath Accepted';
                subText.textContent = '    ';
                success.style.display = 'block';
            } else {
                btn.classList.remove('checked');
                section.classList.remove('checked');
                checkIcon.style.display = 'none';
                mainText.textContent = 'Accept Oath';
                subText.textContent = '  ';
                success.style.display = 'none';
            }
        }

        function handlePage8Back() {
            goToPage(7);
        }

        function handlePage8Next() {
            if (!formData.conversation) initializeConversation();

            let hasErrors = false;
            const banner = document.getElementById('error-banner-page8');
            const conversationSection = document.getElementById('conversation-section');
            const conversationBadge = document.getElementById('conversation-error-badge');
            const oathSection = document.getElementById('oath-section');
            const oathBadge = document.getElementById('oath-error-badge');
            const oathBtn = document.getElementById('oath-btn');
            const conversationsErrorText = document.getElementById('error-conversations-text');
            const oathErrorText = document.getElementById('error-oath-text');

            // Check all conversations
            const allConversationsChecked = formData.conversation.checks.every(c => c === true);
            if (!allConversationsChecked) {
                hasErrors = true;
                if (conversationSection) conversationSection.classList.add('error');
                if (conversationBadge) conversationBadge.style.display = 'block';
                if (conversationsErrorText) conversationsErrorText.style.display = 'block';

                // Show error on unchecked points
                formData.conversation.checks.forEach((checked, index) => {
                    if (!checked) {
                        const point = document.getElementById(`conv-point-${index}`);
                        const error = document.getElementById(`error-point-${index}`);
                        const checkbox = document.getElementById(`checkbox-${index}`);
                        if (point) point.classList.add('error');
                        if (error) error.style.display = 'block';
                        if (checkbox) checkbox.classList.add('error');
                    }
                });
            } else {
                if (conversationSection) conversationSection.classList.remove('error');
                if (conversationBadge) conversationBadge.style.display = 'none';
                if (conversationsErrorText) conversationsErrorText.style.display = 'none';
            }

            // Check oath
            if (!formData.conversation.oathAccepted) {
                hasErrors = true;
                if (oathSection) oathSection.classList.add('error');
                if (oathBadge) oathBadge.style.display = 'block';
                if (oathBtn) oathBtn.classList.add('error');
                if (oathErrorText) oathErrorText.style.display = 'block';
            } else {
                if (oathSection) oathSection.classList.remove('error');
                if (oathBadge) oathBadge.style.display = 'none';
                if (oathBtn) oathBtn.classList.remove('error');
                if (oathErrorText) oathErrorText.style.display = 'none';
            }

            if (hasErrors) {
                if (banner) banner.classList.add('show');
                const formContent = document.querySelector('#page8 .form-content');
                if (formContent) {
                    formContent.scrollTo({ top: 0, behavior: 'smooth' });
                }
                return;
            } else {
                if (banner) banner.classList.remove('show');
            }

            console.log('Page 8 validated successfully!', formData.conversation);
            goToPage(9);
        }

        // ============================================
        // PAGE 9 FUNCTIONS (Signatures)
        // ============================================

        let canvasState = {
            isDrawing: false,
            lastPos: { x: 0, y: 0 },
            activeCanvas: null
        };

        function initializeSignatures() {
            if (!formData.signatures) {
                formData.signatures = {
                    supervisor: null,
                    members: []
                };
                saveFormData();
            }
        }

        function renderSignatures() {
            initializeSignatures();

            // Display supervisor info from Page 3 data
            const supervisorNameEl = document.getElementById('supervisor-name-display');
            
            if (supervisorNameEl) {
                if (formData.supervisorName && formData.supervisorEmpId) {
                    supervisorNameEl.innerHTML = `
                        <strong>${formData.supervisorName}</strong><br>
                        <span style="font-size: 12px; color: #666;">Emp. ID/CNIC: ${formData.supervisorEmpId}</span>
                    `;
                } else {
                    supervisorNameEl.innerHTML = `<span style="color: #EF4444;">No supervisor data found</span>`;
                }
            }

            // Setup supervisor canvas after DOM is ready
            setTimeout(() => {
                console.log('Setting up supervisor canvas');
                setupCanvas('supervisor');

                // Restore supervisor signature if exists
                if (formData.signatures.supervisor) {
                    restoreCanvasSignature('supervisor', formData.signatures.supervisor);
                }
            }, 50);
        }

        function setupCanvas(canvasId) {
            const canvas = document.getElementById(`${canvasId}-canvas`);
            if (!canvas) {
                console.warn('Canvas not found:', canvasId);
                return;
            }

            // Remove any existing event listeners by cloning the canvas
            const newCanvas = canvas.cloneNode(true);
            canvas.parentNode.replaceChild(newCanvas, canvas);
            
            // Get the fresh canvas reference
            const freshCanvas = document.getElementById(`${canvasId}-canvas`);
            if (!freshCanvas) return;

            const ctx = freshCanvas.getContext('2d');
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // Create event handler functions
            const handleMouseDown = (e) => startDrawing(e, canvasId);
            const handleMouseMove = (e) => draw(e, canvasId);
            const handleMouseUp = () => stopDrawing(canvasId);
            const handleMouseLeave = () => stopDrawing(canvasId);
            
            const handleTouchStart = (e) => {
                e.preventDefault();
                startDrawing(e, canvasId);
            };
            const handleTouchMove = (e) => {
                e.preventDefault();
                draw(e, canvasId);
            };
            const handleTouchEnd = (e) => {
                e.preventDefault();
                stopDrawing(canvasId);
            };

            // Mouse events
            freshCanvas.addEventListener('mousedown', handleMouseDown);
            freshCanvas.addEventListener('mousemove', handleMouseMove);
            freshCanvas.addEventListener('mouseup', handleMouseUp);
            freshCanvas.addEventListener('mouseleave', handleMouseLeave);

            // Touch events
            freshCanvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            freshCanvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            freshCanvas.addEventListener('touchend', handleTouchEnd, { passive: false });
            
            console.log('Canvas setup complete for:', canvasId);
        }

        function startDrawing(e, canvasId) {
            const canvas = document.getElementById(`${canvasId}-canvas`);
            if (!canvas) return;

            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            let clientX, clientY;
            if (e.type.includes('touch')) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            const x = (clientX - rect.left) * scaleX;
            const y = (clientY - rect.top) * scaleY;

            canvasState.isDrawing = true;
            canvasState.activeCanvas = canvasId;
            canvasState.lastPos = { x, y };
        }

        function draw(e, canvasId) {
            if (!canvasState.isDrawing || canvasState.activeCanvas !== canvasId) return;

            const canvas = document.getElementById(`${canvasId}-canvas`);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            let clientX, clientY;
            if (e.type.includes('touch')) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            const x = (clientX - rect.left) * scaleX;
            const y = (clientY - rect.top) * scaleY;

            ctx.beginPath();
            ctx.moveTo(canvasState.lastPos.x, canvasState.lastPos.y);
            ctx.lineTo(x, y);
            ctx.stroke();

            canvasState.lastPos = { x, y };
        }

        function stopDrawing(canvasId) {
            if (canvasState.isDrawing && canvasState.activeCanvas === canvasId) {
                const canvas = document.getElementById(`${canvasId}-canvas`);
                if (canvas) {
                    const signatureData = canvas.toDataURL('image/png');
                    
                    // Save signature
                    if (canvasId === 'supervisor') {
                        formData.signatures.supervisor = signatureData;
                    } else if (canvasId.startsWith('member-')) {
                        const memberIndex = parseInt(canvasId.split('-')[1]);
                        formData.signatures.members[memberIndex] = signatureData;
                    }
                    saveFormData();

                    // Clear errors
                    clearSignatureError(canvasId);
                }
            }
            canvasState.isDrawing = false;
            canvasState.activeCanvas = null;
        }

        function clearSignature(canvasId) {
            const canvas = document.getElementById(`${canvasId}-canvas`);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Clear saved signature
            if (canvasId === 'supervisor') {
                formData.signatures.supervisor = null;
            } else if (canvasId.startsWith('member-')) {
                const memberIndex = parseInt(canvasId.split('-')[1]);
                formData.signatures.members[memberIndex] = null;
            }
            saveFormData();
        }

        function restoreCanvasSignature(canvasId, signatureData) {
            const canvas = document.getElementById(`${canvasId}-canvas`);
            if (!canvas || !signatureData) return;

            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = function() {
                ctx.drawImage(img, 0, 0);
            };
            img.src = signatureData;
        }

        function clearSignatureError(canvasId) {
            const card = document.getElementById(`${canvasId}-signature-card`);
            const badge = document.getElementById(`${canvasId}-error-badge`);
            const container = document.getElementById(`${canvasId}-canvas-container`);
            const hint = document.getElementById(`${canvasId}-hint`);

            if (card) card.classList.remove('error');
            if (badge) badge.style.display = 'none';
            if (container) container.classList.remove('error');
            if (hint) hint.classList.remove('error');
        }

        function showSignatureError(canvasId) {
            const card = document.getElementById(`${canvasId}-signature-card`);
            const badge = document.getElementById(`${canvasId}-error-badge`);
            const container = document.getElementById(`${canvasId}-canvas-container`);
            const hint = document.getElementById(`${canvasId}-hint`);

            if (card) card.classList.add('error');
            if (badge) badge.style.display = 'block';
            if (container) container.classList.add('error');
            if (hint) {
                hint.classList.add('error');
                hint.textContent = ' Required / ';
            }
        }

        function handlePage9Back() {
            goToPage(8);
        }

        function handlePage9Complete() {
            if (!formData.signatures) initializeSignatures();

            const banner = document.getElementById('error-banner-page9');

            // Validate only supervisor signature
            if (!formData.signatures.supervisor) {
                showSignatureError('supervisor');
                if (banner) banner.classList.add('show');
                const formContent = document.querySelector('#page9 .form-content');
                if (formContent) {
                    formContent.scrollTo({ top: 0, behavior: 'smooth' });
                }
                return;
            } else {
                clearSignatureError('supervisor');
                if (banner) banner.classList.remove('show');
            }

            console.log(' Supervisor signature validated!', formData.signatures.supervisor);
            
            // Navigate to Page 10 (PQC Rating)
            goToPage(10);
        }

        // ============================================
        // PAGE 10 FUNCTIONS (PQC Supervisor Rating)
        // ============================================

        function initializePQCRating() {
            if (!formData.pqcRating) {
                formData.pqcRating = '';
                saveFormData();
            }
        }

        function renderPQCPage() {
            initializePQCRating();

            const isPQCRequired = formData.pqcRequired === 'yes';
            const disabledNotice = document.getElementById('pqc-disabled-notice');
            const ratingCard = document.getElementById('pqc-rating-card');
            const infoNote = document.getElementById('pqc-info-note');

            if (!isPQCRequired) {
                // Show disabled notice
                if (disabledNotice) disabledNotice.style.display = 'block';
                if (ratingCard) ratingCard.style.opacity = '0.5';
                if (ratingCard) ratingCard.style.pointerEvents = 'none';
                if (infoNote) infoNote.style.display = 'none';
            } else {
                // Show rating options
                if (disabledNotice) disabledNotice.style.display = 'none';
                if (ratingCard) ratingCard.style.opacity = '1';
                if (ratingCard) ratingCard.style.pointerEvents = 'auto';
                if (infoNote) infoNote.style.display = 'block';

                // Restore selected rating if exists
                if (formData.pqcRating) {
                    updateRatingDisplay(formData.pqcRating);
                }
            }
        }

        function selectRating(rating) {
            const isPQCRequired = formData.pqcRequired === 'yes';
            if (!isPQCRequired) return;

            formData.pqcRating = rating;
            saveFormData();

            updateRatingDisplay(rating);

            // Clear errors
            const ratingCard = document.getElementById('pqc-rating-card');
            const ratingError = document.getElementById('rating-error');
            const banner = document.getElementById('error-banner-page10');

            if (ratingCard) ratingCard.classList.remove('error');
            if (ratingError) ratingError.style.display = 'none';
            if (banner) banner.classList.remove('show');

            // Clear error styling from all buttons
            ['good', 'satisfactory', 'needs_improvement'].forEach(r => {
                const btn = document.getElementById(`rating-${r}`);
                if (btn) btn.classList.remove('error');
            });
        }

        function updateRatingDisplay(selectedRating) {
            // Clear all selections
            ['good', 'satisfactory', 'needs_improvement'].forEach(rating => {
                const btn = document.getElementById(`rating-${rating}`);
                if (btn) {
                    btn.classList.remove('selected', 'good', 'satisfactory', 'needs_improvement');
                }
            });

            // Set selected rating
            const selectedBtn = document.getElementById(`rating-${selectedRating}`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected', selectedRating);
            }
        }

        function handlePage10Back() {
            goToPage(9);
        }

        function handlePage10Next() {
            const isPQCRequired = formData.pqcRequired === 'yes';

            // If PQC not required, skip validation and proceed
            if (!isPQCRequired) {
                console.log('PQC not required, proceeding to completion');
                completeForm();
                return;
            }

            // Validate rating selection
            if (!formData.pqcRating) {
                const ratingCard = document.getElementById('pqc-rating-card');
                const ratingError = document.getElementById('rating-error');
                const banner = document.getElementById('error-banner-page10');

                if (ratingCard) ratingCard.classList.add('error');
                if (ratingError) ratingError.style.display = 'block';
                if (banner) banner.classList.add('show');

                // Add error styling to all buttons
                ['good', 'satisfactory', 'needs_improvement'].forEach(rating => {
                    const btn = document.getElementById(`rating-${rating}`);
                    if (btn) btn.classList.add('error');
                });

                const formContent = document.querySelector('#page10 .form-content');
                if (formContent) {
                    formContent.scrollTo({ top: 0, behavior: 'smooth' });
                }
                return;
            }

            console.log('Page 10 validated successfully! Rating:', formData.pqcRating);
            completeForm();
        }

        function completeForm() {
            // Generate TRIC ID based on timestamp
            const now = new Date();
            const tricId = `TRIC-${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(now.getSeconds()).padStart(2, '0')}`;
            
            // Mark form as completed
            formData.completedAt = now.toISOString();
            formData.tricId = tricId;
            saveFormData();

            console.log(' TRIC Form Completed!', formData);

            // Navigate to completion page
            goToPage(11);
            
            // Update TRIC ID display
            setTimeout(() => {
                const tricIdDisplay = document.getElementById('tric-id-display');
                if (tricIdDisplay) {
                    tricIdDisplay.textContent = `TRIC ID: ${tricId}`;
                }
            }, 100);
        }

        async function downloadPDF() {
            console.log('Download PDF button clicked');
            console.log('Complete Form Data:', JSON.stringify(formData, null, 2));
            
            // Get button element
            const button = event.target.closest('button');
            const originalHTML = button.innerHTML;
            
            try {
                // Show loading state
                button.innerHTML = '<span>Loading PDF Library...</span>';
                button.disabled = true;
                
                // Load PDF library
                await loadPDFLibrary();
                
                if (typeof window.jspdf === 'undefined') {
                    throw new Error('PDF library failed to load');
                }
                
                button.innerHTML = '<span>Generating PDF...</span>';

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let yPos = 15;
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 15;
                const contentWidth = pageWidth - (margin * 2);
                
                // Hazard stripe borders on sides
                function addHazardStripes(doc) {
                    doc.setFillColor(255, 205, 0); // Yellow
                    doc.rect(0, 0, 5, pageHeight, 'F');
                    doc.rect(pageWidth - 5, 0, 5, pageHeight, 'F');
                    doc.setFillColor(0, 0, 0); // Black stripes
                    for (let i = 0; i < pageHeight; i += 10) {
                        doc.rect(0, i, 5, 5, 'F');
                        doc.rect(pageWidth - 5, i, 5, 5, 'F');
                    }
                }
                
                addHazardStripes(doc);
                
                // Header - TRIC FORM
                doc.setTextColor(220, 38, 38); // Red
                doc.setFontSize(32);
                doc.setFont('helvetica', 'bold');
                doc.text('TRIC FORM', pageWidth / 2, yPos, { align: 'center' });
                yPos += 10;
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text('Toolbox Talk Risk Identification & Control', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                
                // Orange line separator
                doc.setDrawColor(255, 140, 0);
                doc.setLineWidth(1);
                doc.line(margin, yPos, pageWidth - margin, yPos);
                yPos += 8;
                
                // Date, Time, TRIC ID - TABLE FORMAT
                doc.setDrawColor(0, 0, 0);
                doc.setLineWidth(0.5);
                
                const col1 = margin;
                const col2 = margin + (contentWidth * 0.33);
                const col3 = margin + (contentWidth * 0.66);
                const col4 = pageWidth - margin;
                const rowHeight = 10;
                
                // Header row
                doc.setFillColor(255, 255, 255);
                doc.rect(col1, yPos, col2 - col1, rowHeight, 'FD');
                doc.rect(col2, yPos, col3 - col2, rowHeight, 'FD');
                doc.rect(col3, yPos, col4 - col3, rowHeight, 'FD');
                
                doc.setTextColor(220, 38, 38);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text('Date:', col1 + 2, yPos + 7);
                doc.text('Time:', col2 + 2, yPos + 7);
                doc.text('TRIC ID:', col3 + 2, yPos + 7);
                
                yPos += rowHeight;
                
                // Data row
                doc.setFillColor(255, 255, 255);
                doc.rect(col1, yPos, col2 - col1, rowHeight, 'FD');
                doc.rect(col2, yPos, col3 - col2, rowHeight, 'FD');
                doc.rect(col3, yPos, col4 - col3, rowHeight, 'FD');
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(formData.date || '', col1 + 2, yPos + 7);
                doc.text(formData.time || '', col2 + 2, yPos + 7);
                doc.text(formData.tricId || '', col3 + 2, yPos + 7);
                
                yPos += rowHeight + 8;
                
                // BASIC DETAILS - Orange Section Header
                doc.setFillColor(255, 200, 150);
                doc.setDrawColor(255, 140, 0);
                doc.roundedRect(margin, yPos, contentWidth, 10, 3, 3, 'FD');
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('BASIC DETAILS', pageWidth / 2, yPos + 7, { align: 'center' });
                
                yPos += 14;
                
                // Row 1: BU, Region, Cluster/Zone
                const smallCol1 = margin;
                const smallCol2 = margin + (contentWidth * 0.5);
                const smallCol3 = pageWidth - margin;
                
                doc.setDrawColor(0, 0, 0);
                doc.setLineWidth(0.5);
                
                // BU
                doc.rect(smallCol1, yPos, (smallCol2 - smallCol1) * 0.3, rowHeight, 'D');
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('BU', smallCol1 + 2, yPos + 7);
                
                doc.rect(smallCol1 + (smallCol2 - smallCol1) * 0.3, yPos, (smallCol2 - smallCol1) * 0.7, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.bu || '', smallCol1 + (smallCol2 - smallCol1) * 0.3 + 2, yPos + 7);
                
                // Region
                doc.rect(smallCol2, yPos, (smallCol3 - smallCol2) * 0.3, rowHeight, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('Region', smallCol2 + 2, yPos + 7);
                
                doc.rect(smallCol2 + (smallCol3 - smallCol2) * 0.3, yPos, (smallCol3 - smallCol2) * 0.7, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.region || '', smallCol2 + (smallCol3 - smallCol2) * 0.3 + 2, yPos + 7);
                
                yPos += rowHeight;
                
                // Row 2: Cluster/Zone
                doc.rect(smallCol1, yPos, (contentWidth) * 0.25, rowHeight, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('Cluster/Zone', smallCol1 + 2, yPos + 7);
                
                doc.rect(smallCol1 + (contentWidth) * 0.25, yPos, contentWidth * 0.75, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.clusterZone || '', smallCol1 + (contentWidth) * 0.25 + 2, yPos + 7);
                
                yPos += rowHeight;
                
                // Row 3: IBC, Dept, Sub Dept
                doc.rect(smallCol1, yPos, (smallCol2 - smallCol1) * 0.25, rowHeight, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('IBC', smallCol1 + 2, yPos + 7);
                
                doc.rect(smallCol1 + (smallCol2 - smallCol1) * 0.25, yPos, (smallCol2 - smallCol1) * 0.75, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.ibc || '', smallCol1 + (smallCol2 - smallCol1) * 0.25 + 2, yPos + 7);
                
                doc.rect(smallCol2, yPos, (smallCol3 - smallCol2) * 0.25, rowHeight, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('Dept.', smallCol2 + 2, yPos + 7);
                
                doc.rect(smallCol2 + (smallCol3 - smallCol2) * 0.25, yPos, (smallCol3 - smallCol2) * 0.75, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.deptSection || '', smallCol2 + (smallCol3 - smallCol2) * 0.25 + 2, yPos + 7);
                
                yPos += rowHeight;
                
                // Row 4: Sub Dept
                doc.rect(smallCol1, yPos, (contentWidth) * 0.25, rowHeight, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('Sub Dept.', smallCol1 + 2, yPos + 7);
                
                doc.rect(smallCol1 + (contentWidth) * 0.25, yPos, contentWidth * 0.75, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.subDept || '', smallCol1 + (contentWidth) * 0.25 + 2, yPos + 7);
                
                yPos += rowHeight;
                
                // Row 5: MTL No, LOTO No, PTW No
                const thirdWidth = contentWidth / 3;
                
                doc.rect(margin, yPos, thirdWidth * 0.35, rowHeight, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('MTL No.', margin + 2, yPos + 7);
                
                doc.rect(margin + thirdWidth * 0.35, yPos, thirdWidth * 0.65, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.mtlNo || '', margin + thirdWidth * 0.35 + 2, yPos + 7);
                
                doc.rect(margin + thirdWidth, yPos, thirdWidth * 0.35, rowHeight, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('LOTO No.', margin + thirdWidth + 2, yPos + 7);
                
                doc.rect(margin + thirdWidth * 1.35, yPos, thirdWidth * 0.65, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.lotoNo || '', margin + thirdWidth * 1.35 + 2, yPos + 7);
                
                doc.rect(margin + thirdWidth * 2, yPos, thirdWidth * 0.35, rowHeight, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('PTW No.', margin + thirdWidth * 2 + 2, yPos + 7);
                
                doc.rect(margin + thirdWidth * 2.35, yPos, thirdWidth * 0.65, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.ptwNo || '', margin + thirdWidth * 2.35 + 2, yPos + 7);
                
                yPos += rowHeight + 8;
                
                // Job Location
                yPos = checkNewPage(doc, yPos, 15, pageHeight, addHazardStripes);
                doc.rect(margin, yPos, contentWidth * 0.25, rowHeight, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('Job Location:', margin + 2, yPos + 7);
                
                doc.rect(margin + contentWidth * 0.25, yPos, contentWidth * 0.75, rowHeight, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(formData.jobLocation || '', margin + contentWidth * 0.25 + 2, yPos + 7);
                
                yPos += rowHeight + 2;
                
                // Work Details
                doc.rect(margin, yPos, contentWidth * 0.25, 15, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('Work Details:', margin + 2, yPos + 5);
                
                doc.rect(margin + contentWidth * 0.25, yPos, contentWidth * 0.75, 15, 'D');
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(9);
                const workLines = doc.splitTextToSize(formData.workDetails || '', contentWidth * 0.75 - 4);
                doc.text(workLines, margin + contentWidth * 0.25 + 2, yPos + 5);
                
                yPos += 17;
                
                // TEAM MEMBERS SECTION
                yPos = checkNewPage(doc, yPos, 35, pageHeight, addHazardStripes);
                yPos = addSectionHeader(doc, 'TEAM MEMBERS', yPos, margin, contentWidth);
                
                // TEAM MEMBERS - Table Format
                const rowHeight2 = 10;
                
                // Supervisor row
                doc.rect(margin, yPos, contentWidth * 0.3, rowHeight2, 'D');
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('Supervisor:', margin + 2, yPos + 7);
                
                doc.rect(margin + contentWidth * 0.3, yPos, contentWidth * 0.7, rowHeight2, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(`${formData.supervisorName || ''} / ${formData.supervisorEmpId || ''}`, margin + contentWidth * 0.3 + 2, yPos + 7);
                
                yPos += rowHeight2;
                
                // Team Member row
                doc.rect(margin, yPos, contentWidth * 0.3, rowHeight2, 'D');
                doc.setFont('helvetica', 'bold');
                doc.text('Team Member:', margin + 2, yPos + 7);
                
                doc.rect(margin + contentWidth * 0.3, yPos, contentWidth * 0.7, rowHeight2, 'D');
                doc.setFont('helvetica', 'normal');
                doc.text(`${formData.memberName || ''} / ${formData.memberEmpId || ''}`, margin + contentWidth * 0.3 + 2, yPos + 7);
                
                yPos += rowHeight2;
                
                // PQC Supervisor if required
                if (formData.pqcRequired === 'yes' && formData.pqcName) {
                    doc.rect(margin, yPos, contentWidth * 0.3, rowHeight2, 'D');
                    doc.setFont('helvetica', 'bold');
                    doc.text('PQC Supervisor:', margin + 2, yPos + 7);
                    
                    doc.rect(margin + contentWidth * 0.3, yPos, contentWidth * 0.7, rowHeight2, 'D');
                    doc.setFont('helvetica', 'normal');
                    doc.text(`${formData.pqcName} / ${formData.pqcEmpId || ''}`, margin + contentWidth * 0.3 + 2, yPos + 7);
                    
                    yPos += rowHeight2;
                }
                
                // Additional Members
                if (formData.additionalMembers && formData.additionalMembers.length > 0) {
                    formData.additionalMembers.forEach((member, idx) => {
                        yPos = checkNewPage(doc, yPos, 12, pageHeight, addHazardStripes);
                        
                        doc.rect(margin, yPos, contentWidth * 0.3, rowHeight2, 'D');
                        doc.setFont('helvetica', 'bold');
                        doc.text(`Member ${idx + 3}:`, margin + 2, yPos + 7);
                        
                        doc.rect(margin + contentWidth * 0.3, yPos, contentWidth * 0.7, rowHeight2, 'D');
                        doc.setFont('helvetica', 'normal');
                        doc.text(`${member.name} / ${member.empId}`, margin + contentWidth * 0.3 + 2, yPos + 7);
                        
                        yPos += rowHeight2;
                    });
                }
                
                yPos += 8;
                // PPE Section - Show ALL PPE with their status (//N/A)
                yPos = checkNewPage(doc, yPos, 50, pageHeight, addHazardStripes);
                yPos = addSectionHeader(doc, 'PERSONAL PROTECTIVE EQUIPEMENT (PPE)', yPos, margin, contentWidth);
                
                if (formData.ppe && formData.ppe.length > 0) {
                    doc.setFontSize(8);
                    const colWidth = contentWidth / 3;
                    let col = 0;
                    
                    formData.ppe.forEach((ppe) => {
                        const xPos = margin + (col * colWidth);
                        
                        // Determine status
                        const status = ppe.status || '';
                        
                        // Draw status box
                        if (status === 'available') {
                            // GREEN box with white tick
                            doc.setDrawColor(34, 197, 94);
                            doc.setFillColor(34, 197, 94);
                            doc.rect(xPos + 2, yPos - 3, 3, 3, 'FD');
                            doc.setTextColor(255, 255, 255);
                            doc.setFont('helvetica', 'bold');
                            doc.text('', xPos + 2.5, yPos - 0.5);
                        } else if (status === 'not-available') {
                            // RED box with white cross
                            doc.setDrawColor(239, 68, 68);
                            doc.setFillColor(239, 68, 68);
                            doc.rect(xPos + 2, yPos - 3, 3, 3, 'FD');
                            doc.setTextColor(255, 255, 255);
                            doc.setFont('helvetica', 'bold');
                            doc.text('', xPos + 2.3, yPos - 0.5);
                        } else if (status === 'na') {
                            // GRAY box with N/A
                            doc.setDrawColor(156, 163, 175);
                            doc.setFillColor(243, 244, 246);
                            doc.rect(xPos + 2, yPos - 3, 7, 3, 'FD');
                            doc.setTextColor(75, 85, 99);
                            doc.setFont('helvetica', 'bold');
                            doc.setFontSize(6);
                            doc.text('N/A', xPos + 2.5, yPos - 0.5);
                            doc.setFontSize(8);
                        } else {
                            // Empty gray box if no status
                            doc.setDrawColor(200, 200, 200);
                            doc.rect(xPos + 2, yPos - 3, 3, 3);
                        }
                        
                        // PPE name
                        doc.setTextColor(0, 0, 0);
                        doc.setFont('helvetica', 'normal');
                        const text = ppe.english || ppe.name || 'Unknown PPE';
                        const maxWidth = colWidth - 12;
                        const lines = doc.splitTextToSize(text, maxWidth);
                        doc.text(lines, xPos + 10, yPos);
                        
                        col++;
                        if (col >= 3) {
                            col = 0;
                            yPos += 6;
                        }
                    });
                    
                    if (col > 0) yPos += 6;
                } else {
                    doc.setFontSize(9);
                    doc.text('No PPE specified', margin + 5, yPos);
                    yPos += 6;
                }
                yPos += 8;
                
                // Tools Section - Show ALL tools with their status (//N/A)
                yPos = checkNewPage(doc, yPos, 50, pageHeight, addHazardStripes);
                yPos = addSectionHeader(doc, 'TOOLS REQUIRED', yPos, margin, contentWidth);
                
                if (formData.tools && formData.tools.length > 0) {
                    doc.setFontSize(8);
                    const colWidth = contentWidth / 3;
                    let col = 0;
                    
                    formData.tools.forEach((tool) => {
                        const xPos = margin + (col * colWidth);
                        
                        // Determine status
                        const status = tool.status || '';
                        
                        // Draw status box
                        if (status === 'available') {
                            // GREEN box with white tick
                            doc.setDrawColor(34, 197, 94);
                            doc.setFillColor(34, 197, 94);
                            doc.rect(xPos + 2, yPos - 3, 3, 3, 'FD');
                            doc.setTextColor(255, 255, 255);
                            doc.setFont('helvetica', 'bold');
                            doc.text('', xPos + 2.5, yPos - 0.5);
                        } else if (status === 'not-available') {
                            // RED box with white cross
                            doc.setDrawColor(239, 68, 68);
                            doc.setFillColor(239, 68, 68);
                            doc.rect(xPos + 2, yPos - 3, 3, 3, 'FD');
                            doc.setTextColor(255, 255, 255);
                            doc.setFont('helvetica', 'bold');
                            doc.text('', xPos + 2.3, yPos - 0.5);
                        } else if (status === 'na') {
                            // GRAY box with N/A
                            doc.setDrawColor(156, 163, 175);
                            doc.setFillColor(243, 244, 246);
                            doc.rect(xPos + 2, yPos - 3, 7, 3, 'FD');
                            doc.setTextColor(75, 85, 99);
                            doc.setFont('helvetica', 'bold');
                            doc.setFontSize(6);
                            doc.text('N/A', xPos + 2.5, yPos - 0.5);
                            doc.setFontSize(8);
                        } else {
                            // Empty gray box if no status
                            doc.setDrawColor(200, 200, 200);
                            doc.rect(xPos + 2, yPos - 3, 3, 3);
                        }
                        
                        // Tool name
                        doc.setTextColor(0, 0, 0);
                        doc.setFont('helvetica', 'normal');
                        const text = tool.english || tool.name || 'Unknown Tool';
                        const maxWidth = colWidth - 12;
                        const lines = doc.splitTextToSize(text, maxWidth);
                        doc.text(lines, xPos + 10, yPos);
                        
                        col++;
                        if (col >= 3) {
                            col = 0;
                            yPos += 6;
                        }
                    });
                    
                    if (col > 0) yPos += 6;
                } else {
                    doc.setFontSize(9);
                    doc.text('No tools specified', margin + 5, yPos);
                    yPos += 6;
                }
                yPos += 8;
                
                // Safety Instructions - Show ALL 11 instructions with Yes/No status
                yPos = checkNewPage(doc, yPos, 50, pageHeight, addHazardStripes);
                yPos = addSectionHeader(doc, 'NECESSARY SAFETY INSTRUCTIONS', yPos, margin, contentWidth);
                
                // The 11 fixed instructions from the form
                const instructionTexts = [
                    "Have all identified isolation points PMT/SS/RMU/KS/LBS and other connected feeders been closed as per the Line Isolation SOP?",
                    "Are all operations performed with AOC coordination?",
                    "Has the supervisor confirmed the absence of supply with a line tester?",
                    "Have the system/equipment be grounded and shorted for this operation?",
                    "Is the far end grounded and shorted?",
                    "Is the far end grounded and shorted?",
                    "Have all the LT circuits and street lights been turned off?",
                    "Are all closed LT circuits grounded and shorted?",
                    "Did PTW exchange with the concerned supervisor?",
                    "Has the lineman/fitter jointer verified the absence of supply and ground and short with a live line tester?",
                    "If the use of a portable ladder is necessary, have you ensured its usable condition?"
                ];
                
                if (formData.instructions && formData.instructions.length > 0) {
                    doc.setFontSize(8);
                    formData.instructions.forEach((inst, index) => {
                        yPos = checkNewPage(doc, yPos, 10, pageHeight, addHazardStripes);
                        
                        const status = inst.status || '';
                        
                        // Draw status indicator
                        if (status === 'yes') {
                            // GREEN box with white tick for Yes
                            doc.setDrawColor(34, 197, 94);
                            doc.setFillColor(34, 197, 94);
                            doc.rect(margin + 3, yPos - 3, 3, 3, 'FD');
                            doc.setTextColor(255, 255, 255);
                            doc.setFont('helvetica', 'bold');
                            doc.text('', margin + 3.5, yPos - 0.5);
                        } else if (status === 'no') {
                            // RED box with white cross for No
                            doc.setDrawColor(239, 68, 68);
                            doc.setFillColor(239, 68, 68);
                            doc.rect(margin + 3, yPos - 3, 3, 3, 'FD');
                            doc.setTextColor(255, 255, 255);
                            doc.setFont('helvetica', 'bold');
                            doc.text('', margin + 3.3, yPos - 0.5);
                        } else {
                            // Empty gray box if no selection
                            doc.setDrawColor(200, 200, 200);
                            doc.rect(margin + 3, yPos - 3, 3, 3);
                        }
                        
                        // Instruction text - use exact text from array
                        doc.setTextColor(0, 0, 0);
                        doc.setFont('helvetica', 'normal');
                        const text = instructionTexts[index] || 'Unknown instruction';
                        const lines = doc.splitTextToSize(text, contentWidth - 15);
                        doc.text(lines, margin + 8, yPos);
                        yPos += (lines.length * 4) + 3;
                    });
                } else {
                    doc.setFontSize(9);
                    doc.text('No instructions available', margin + 5, yPos);
                    yPos += 6;
                }
                yPos += 8;
                
                // Hazards Section - Show ALL 9 hazards with exact names, Yes/No status, and control measures
                yPos = checkNewPage(doc, yPos, 50, pageHeight, addHazardStripes);
                yPos = addSectionHeader(doc, 'HAZARDS & CONTROL MEASURES', yPos, margin, contentWidth);
                
                // The 9 exact hazard data from the form (with controls)
                const hazardsFullData = [
                    {
                        title: 'Presence of electric current/Electric Arch',
                        controls: ['Line isolation and rubber gloves', 'Face shield/anti-flash hood']
                    },
                    {
                        title: 'Ineffective / Incorrect communication',
                        controls: ['Repeating communication between site supervisor, in-charge, AOC, and OCR', 'Reconfirmation of isolation point']
                    },
                    {
                        title: 'Fall/Fall from height',
                        controls: ['Safety harness', 'Secure ladder']
                    },
                    {
                        title: 'Traffic hazards',
                        controls: ['Safety cones', 'Fluorescent jacket']
                    },
                    {
                        title: 'Injured (crushed) fingers and hands',
                        controls: ['Use of gloves', 'Handling according to weight', 'Manual handling']
                    },
                    {
                        title: 'Slip / Trip',
                        controls: ['Safety Shoes']
                    },
                    {
                        title: 'Falling of tools/objects from height during work',
                        controls: ['Safety helmet with chin strap']
                    },
                    {
                        title: 'Safe Parking / Striking an object or vehicle',
                        controls: ['Restrict public access to the area by placing safety cones and safety tape.']
                    },
                    {
                        title: 'Public Hazards',
                        controls: ['Falling from height during work', 'Striking an object or vehicle', 'Inspect remaining components after completion of work'],
                        hasPoleId: true,
                        poleIdQuestion: 'If the pole is grounded, select tick mark, otherwise write Pole ID. Is HT line earth guard wire present?',
                        additionalControls: ['Restrict public access to the area by placing safety cones and safety tape.', 'Place light indicators for night-time hazards.', 'Clean the work site/area after completion of work.']
                    }
                ];
                
                if (formData.hazards && formData.hazards.length > 0) {
                    doc.setFontSize(8);
                    
                    formData.hazards.forEach((hazard, idx) => {
                        yPos = checkNewPage(doc, yPos, 15, pageHeight, addHazardStripes);
                        
                        const status = hazard.hazardStatus || '';
                        const hazardData = hazardsFullData[idx];
                        
                        // Draw hazard status indicator
                        if (status === 'yes') {
                            // GREEN box with white tick for Yes
                            doc.setDrawColor(34, 197, 94);
                            doc.setFillColor(34, 197, 94);
                            doc.rect(margin + 3, yPos - 3, 3, 3, 'FD');
                            doc.setTextColor(255, 255, 255);
                            doc.setFont('helvetica', 'bold');
                            doc.text('', margin + 3.5, yPos - 0.5);
                        } else if (status === 'no') {
                            // RED box with white cross for No
                            doc.setDrawColor(239, 68, 68);
                            doc.setFillColor(239, 68, 68);
                            doc.rect(margin + 3, yPos - 3, 3, 3, 'FD');
                            doc.setTextColor(255, 255, 255);
                            doc.setFont('helvetica', 'bold');
                            doc.text('', margin + 3.3, yPos - 0.5);
                        } else {
                            // Empty gray box if no selection
                            doc.setDrawColor(200, 200, 200);
                            doc.rect(margin + 3, yPos - 3, 3, 3);
                        }
                        
                        // Hazard title
                        doc.setTextColor(0, 0, 0);
                        doc.setFont('helvetica', 'bold');
                        doc.setFontSize(9);
                        const titleLines = doc.splitTextToSize(hazardData.title, contentWidth - 15);
                        doc.text(titleLines, margin + 8, yPos);
                        yPos += (titleLines.length * 4) + 2;
                        
                        // If hazard is Yes, show control measures
                        if (status === 'yes' && hazard.controls && hazardData.controls) {
                            doc.setFontSize(7);
                            doc.setFont('helvetica', 'italic');
                            doc.setTextColor(100, 100, 100);
                            doc.text('Control Measures:', margin + 10, yPos);
                            yPos += 4;
                            
                            doc.setFont('helvetica', 'normal');
                            doc.setFontSize(7);
                            
                            hazardData.controls.forEach((controlText, controlIdx) => {
                                yPos = checkNewPage(doc, yPos, 8, pageHeight, addHazardStripes);
                                
                                const controlStatus = hazard.controls[controlIdx] ? hazard.controls[controlIdx].status : '';
                                
                                // Draw control status
                                if (controlStatus === 'yes') {
                                    doc.setDrawColor(34, 197, 94);
                                    doc.setFillColor(34, 197, 94);
                                    doc.rect(margin + 12, yPos - 2.5, 2.5, 2.5, 'FD');
                                    doc.setTextColor(255, 255, 255);
                                    doc.setFont('helvetica', 'bold');
                                    doc.setFontSize(5);
                                    doc.text('', margin + 12.5, yPos - 0.5);
                                    doc.setFontSize(7);
                                } else if (controlStatus === 'no') {
                                    doc.setDrawColor(239, 68, 68);
                                    doc.setFillColor(239, 68, 68);
                                    doc.rect(margin + 12, yPos - 2.5, 2.5, 2.5, 'FD');
                                    doc.setTextColor(255, 255, 255);
                                    doc.setFont('helvetica', 'bold');
                                    doc.setFontSize(5);
                                    doc.text('', margin + 12.3, yPos - 0.5);
                                    doc.setFontSize(7);
                                } else {
                                    doc.setDrawColor(200, 200, 200);
                                    doc.rect(margin + 12, yPos - 2.5, 2.5, 2.5);
                                }
                                
                                doc.setTextColor(0, 0, 0);
                                doc.setFont('helvetica', 'normal');
                                const controlLines = doc.splitTextToSize(controlText, contentWidth - 25);
                                doc.text(controlLines, margin + 16, yPos);
                                yPos += (controlLines.length * 3.5) + 2;
                            });
                            
                            // Show Pole ID question and selection for Public Hazards (hazard 9)
                            if (hazardData.hasPoleId) {
                                yPos = checkNewPage(doc, yPos, 8, pageHeight, addHazardStripes);
                                
                                // Show the pole ID question in red box
                                doc.setDrawColor(239, 68, 68);
                                doc.setLineWidth(0.5);
                                doc.rect(margin + 10, yPos - 3, contentWidth - 20, 8);
                                doc.setTextColor(239, 68, 68);
                                doc.setFont('helvetica', 'normal');
                                doc.setFontSize(6.5);
                                const questionLines = doc.splitTextToSize(hazardData.poleIdQuestion, contentWidth - 24);
                                doc.text(questionLines, margin + 12, yPos);
                                yPos += (questionLines.length * 3) + 5;
                                
                                // Show selection
                                if (hazard.poleIdOption === 'tick') {
                                    doc.setTextColor(34, 197, 94);
                                    doc.setFont('helvetica', 'bold');
                                    doc.setFontSize(7);
                                    doc.text(' Pole is grounded', margin + 12, yPos);
                                    yPos += 4;
                                } else if (hazard.poleIdOption === 'poleId' && hazard.poleIdValue) {
                                    doc.setTextColor(0, 0, 0);
                                    doc.setFont('helvetica', 'normal');
                                    doc.setFontSize(7);
                                    doc.text('Pole ID: ' + hazard.poleIdValue, margin + 12, yPos);
                                    yPos += 4;
                                }
                            }
                            
                            // Show additional controls for Public Hazards
                            if (hazardData.additionalControls && hazardData.additionalControls.length > 0) {
                                yPos = checkNewPage(doc, yPos, 10, pageHeight, addHazardStripes);
                                doc.setFontSize(7);
                                doc.setFont('helvetica', 'italic');
                                doc.setTextColor(100, 100, 100);
                                doc.text('Additional Controls:', margin + 10, yPos);
                                yPos += 4;
                                
                                doc.setFont('helvetica', 'normal');
                                hazardData.additionalControls.forEach((controlText, addIdx) => {
                                    yPos = checkNewPage(doc, yPos, 8, pageHeight, addHazardStripes);
                                    
                                    // Calculate the actual control index (after main controls)
                                    const actualControlIdx = hazardData.controls.length + addIdx;
                                    const controlStatus = hazard.controls[actualControlIdx] ? hazard.controls[actualControlIdx].status : '';
                                    
                                    // Draw control status
                                    if (controlStatus === 'yes') {
                                        doc.setDrawColor(34, 197, 94);
                                        doc.setFillColor(34, 197, 94);
                                        doc.rect(margin + 12, yPos - 2.5, 2.5, 2.5, 'FD');
                                        doc.setTextColor(255, 255, 255);
                                        doc.setFont('helvetica', 'bold');
                                        doc.setFontSize(5);
                                        doc.text('', margin + 12.5, yPos - 0.5);
                                        doc.setFontSize(7);
                                    } else if (controlStatus === 'no') {
                                        doc.setDrawColor(239, 68, 68);
                                        doc.setFillColor(239, 68, 68);
                                        doc.rect(margin + 12, yPos - 2.5, 2.5, 2.5, 'FD');
                                        doc.setTextColor(255, 255, 255);
                                        doc.setFont('helvetica', 'bold');
                                        doc.setFontSize(5);
                                        doc.text('', margin + 12.3, yPos - 0.5);
                                        doc.setFontSize(7);
                                    } else {
                                        doc.setDrawColor(200, 200, 200);
                                        doc.rect(margin + 12, yPos - 2.5, 2.5, 2.5);
                                    }
                                    
                                    doc.setTextColor(0, 0, 0);
                                    doc.setFont('helvetica', 'normal');
                                    const controlLines = doc.splitTextToSize(controlText, contentWidth - 25);
                                    doc.text(controlLines, margin + 16, yPos);
                                    yPos += (controlLines.length * 3.5) + 2;
                                });
                            }
                            
                            yPos += 2;
                        }
                        
                        doc.setFontSize(8);
                    });
                } else {
                    doc.setFontSize(9);
                    doc.text('No hazards available', margin + 5, yPos);
                    yPos += 6;
                }
                
                // Other Hazards section
                if (formData.otherHazards && formData.otherHazards.trim()) {
                    yPos = checkNewPage(doc, yPos, 10, pageHeight, addHazardStripes);
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                    doc.text('Other Hazards:', margin + 5, yPos);
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(8);
                    yPos += 5;
                    const lines = doc.splitTextToSize(formData.otherHazards, contentWidth - 10);
                    doc.text(lines, margin + 5, yPos);
                    yPos += (lines.length * 4) + 3;
                }
                yPos += 8;
                
                // TEAM CONVERSATION - Show correct points with red instruction box and oath statement
                yPos = checkNewPage(doc, yPos, 60, pageHeight, addHazardStripes);
                yPos = addSectionHeader(doc, 'TEAM CONVERSATION', yPos, margin, contentWidth);
                
                // RED INSTRUCTION BOX
                yPos = checkNewPage(doc, yPos, 12, pageHeight, addHazardStripes);
                doc.setDrawColor(239, 68, 68);
                doc.setFillColor(254, 242, 242);
                doc.setLineWidth(0.5);
                doc.rect(margin, yPos - 3, contentWidth, 10, 'FD');
                doc.setDrawColor(239, 68, 68);
                doc.rect(margin, yPos - 3, contentWidth, 10);
                doc.setTextColor(239, 68, 68);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(7);
                doc.text('NOTE: Before starting work, discuss these important points with your team:', margin + 2, yPos + 1);
                doc.setFontSize(6.5);
                doc.setFont('helvetica', 'normal');
                doc.text('If other hazards appear at the work site that cannot be controlled, stop the work activity and contact your line manager.', margin + 2, yPos + 5);
                yPos += 14;
                
                if (formData.conversation && formData.conversation.checks) {
                    doc.setFontSize(8);
                    // The 4 exact conversation points from the form
                    const conversationPoints = [
                        'What harm could you face?',
                        'What will you do in case of an emergency during work?',
                        'Have all personnel been informed about the work, hazards, controls, and their responsibilities?',
                        'Have they been made aware of the relevant critical hazard risk assessment in the toolbox talk?'
                    ];
                    
                    conversationPoints.forEach((point, idx) => {
                        yPos = checkNewPage(doc, yPos, 10, pageHeight, addHazardStripes);
                        
                        const isChecked = formData.conversation.checks[idx];
                        
                        // Show actual Tick or Cross symbol
                        doc.setTextColor(0, 0, 0);
                        doc.setFont('helvetica', 'normal');
                        doc.setFontSize(10);
                        if (isChecked) {
                            doc.text('', margin + 3, yPos);
                        } else {
                            doc.text('', margin + 3, yPos);
                        }
                        
                        // Point text
                        doc.setFontSize(8);
                        const lines = doc.splitTextToSize(point, contentWidth - 15);
                        doc.text(lines, margin + 8, yPos);
                        yPos += (lines.length * 4) + 3;
                    });
                    
                    // Safety Oath Section
                    yPos += 5;
                    yPos = checkNewPage(doc, yPos, 20, pageHeight, addHazardStripes);
                    
                    // Oath box
                    doc.setDrawColor(59, 130, 246);
                    doc.setFillColor(239, 246, 255);
                    doc.rect(margin, yPos - 3, contentWidth, 15, 'FD');
                    doc.setDrawColor(59, 130, 246);
                    doc.rect(margin, yPos - 3, contentWidth, 15);
                    
                    // Oath title
                    doc.setTextColor(59, 130, 246);
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(9);
                    doc.text('Safety Oath', margin + 2, yPos + 1);
                    yPos += 5;
                    
                    // Oath statement (English only)
                    doc.setTextColor(0, 0, 0);
                    doc.setFont('helvetica', 'italic');
                    doc.setFontSize(7);
                    doc.text('I hereby certify that all safety measures have been implemented and the work area is safe.', margin + 2, yPos);
                    yPos += 5;
                    
                    // Oath acceptance status
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(8);
                    if (formData.conversation.oathAccepted) {
                        doc.setTextColor(34, 197, 94);
                        doc.text(' ACCEPTED', margin + 2, yPos);
                    } else {
                        doc.setTextColor(239, 68, 68);
                        doc.text(' NOT ACCEPTED', margin + 2, yPos);
                    }
                    yPos += 8;
                }
                
                // PQC Rating
                if (formData.pqcRequired === 'yes' && formData.pqcRating) {
                    yPos = checkNewPage(doc, yPos, 25, pageHeight, addHazardStripes);
                    yPos = addSectionHeader(doc, 'PQC Supervisor Rating', yPos, margin, contentWidth);
                    const ratingText = formData.pqcRating === 'good' ? 'Good' : 
                                      formData.pqcRating === 'satisfactory' ? 'Satisfactory' : 
                                      'Needs Improvement';
                    doc.setFontSize(9);
                    doc.text(`Awareness Rating: ${ratingText}`, margin + 5, yPos);
                    yPos += 10;
                }
                
                // SIGNATURES
                yPos = checkNewPage(doc, yPos, 50, pageHeight, addHazardStripes);
                yPos = addSectionHeader(doc, 'SIGNATURES', yPos, margin, contentWidth);
                
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('Supervisor Signature:', margin + 5, yPos);
                yPos += 5;
                
                if (formData.signatures && formData.signatures.supervisor) {
                    try {
                        doc.addImage(formData.signatures.supervisor, 'PNG', margin + 5, yPos, 50, 15);
                        yPos += 18;
                    } catch (e) {
                        doc.setFont('helvetica', 'normal');
                        doc.text('[Signature Present]', margin + 5, yPos);
                        yPos += 7;
                    }
                }
                
                doc.setFont('helvetica', 'normal');
                doc.text(`${formData.supervisorName || ''} - ${formData.supervisorEmpId || ''}`, margin + 5, yPos);
                
                // Footer on all pages
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(7);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Developed by Shahbaz Anwar AM CHSEQ', margin, pageHeight - 8);
                    doc.text(`Page ${i} of ${pageCount}`, pageWidth - margin - 15, pageHeight - 8);
                }
                
                // Save PDF
                const fileName = `TRIC_${formData.tricId || 'Form'}.pdf`;
                doc.save(fileName);
                
                console.log(' PDF downloaded successfully!');
                button.innerHTML = originalHTML;
                button.disabled = false;
                alert('PDF downloaded successfully!\n\nFile: ' + fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                button.innerHTML = originalHTML;
                button.disabled = false;
                alert('Error generating PDF: ' + error.message + '\n\nPlease try again.');
            }
        }

        // Helper function to render checkbox grid with tick/cross marks

        // Helper function to render checkbox grid with GREEN tick and RED cross
        function renderCheckboxGrid(doc, allOptions, selectedItems, yPos, margin, contentWidth, columns) {
            const colWidth = contentWidth / columns;
            let col = 0;
            
            doc.setFontSize(8);
            
            allOptions.forEach((option) => {
                const xPos = margin + (col * colWidth);
                
                // Check if this item is selected
                const isSelected = selectedItems.some(item => 
                    (item.id && item.id === option.id) || 
                    (item.english && item.english === option.english)
                );
                
                if (isSelected) {
                    // GREEN filled checkbox with white tick
                    doc.setDrawColor(34, 197, 94);
                    doc.setFillColor(34, 197, 94);
                    doc.rect(xPos + 2, yPos - 3, 3, 3, 'FD');
                    doc.setTextColor(255, 255, 255);
                    doc.setFont('helvetica', 'bold');
                    doc.text('', xPos + 2.5, yPos - 0.5);
                } else {
                    // RED filled checkbox with white cross
                    doc.setDrawColor(239, 68, 68);
                    doc.setFillColor(239, 68, 68);
                    doc.rect(xPos + 2, yPos - 3, 3, 3, 'FD');
                    doc.setTextColor(255, 255, 255);
                    doc.setFont('helvetica', 'bold');
                    doc.text('', xPos + 2.3, yPos - 0.5);
                }
                
                // Text
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'normal');
                const text = option.english;
                const maxWidth = colWidth - 10;
                const lines = doc.splitTextToSize(text, maxWidth);
                doc.text(lines, xPos + 7, yPos);
                
                col++;
                if (col >= columns) {
                    col = 0;
                    yPos += 6;
                }
            });
            
            if (col > 0) yPos += 6;
            return yPos;
        }

        function addSectionHeader(doc, title, yPos, margin, width) {
            // Orange rounded section header like sample
            doc.setFillColor(255, 200, 150);
            doc.setDrawColor(255, 140, 0);
            doc.setLineWidth(0.5);
            doc.roundedRect(margin, yPos - 2, width, 10, 3, 3, 'FD');
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            // Calculate center position from margin and width
            doc.text(title, margin + (width / 2), yPos + 5, { align: 'center' });
            doc.setFont('helvetica', 'normal');
            return yPos + 12;
        }

        function checkNewPage(doc, yPos, requiredSpace, pageHeight, addHazardStripes) {
            if (yPos + requiredSpace > pageHeight - 15) {
                doc.addPage();
                addHazardStripes(doc);
                return 20; // Start below header
            }
            return yPos;
        }
        function exportAllData() {
            const allData = {
                currentForm: formData,
                savedForms: JSON.parse(localStorage.getItem('tricForms') || '[]'),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `TRIC_Backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            console.log('Data exported successfully');
            alert(' Data backup downloaded!\n\nKeep this file safe to restore your data later.');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        if (importedData.savedForms) {
                            localStorage.setItem('tricForms', JSON.stringify(importedData.savedForms));
                        }
                        
                        alert(' Data imported successfully!\n\nYour saved forms have been restored.');
                        location.reload();
                    } catch (error) {
                        alert('Error importing data. Please check the file format.');
                        console.error('Import error:', error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function loadPDFLibrary() {
            return new Promise((resolve, reject) => {
                if (window.pdfLibraryLoaded && typeof window.jspdf !== 'undefined') {
                    console.log('jsPDF library already loaded');
                    resolve();
                    return;
                }
                
                if (document.getElementById('jspdf-script')) {
                    const checkLoaded = setInterval(() => {
                        if (window.pdfLibraryLoaded) {
                            clearInterval(checkLoaded);
                            resolve();
                        }
                    }, 100);
                    return;
                }
                
                console.log('Loading jsPDF library...');
                const script = document.createElement('script');
                script.id = 'jspdf-script';
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                script.crossOrigin = 'anonymous';
                script.async = true;
                script.onload = function() {
                    console.log(' jsPDF library loaded successfully');
                    window.pdfLibraryLoaded = true;
                    resolve();
                };
                script.onerror = function() {
                    console.error('Failed to load jsPDF library from CDN');
                    reject(new Error('Failed to load PDF library'));
                };
                document.head.appendChild(script);
            });
        }

        // Don't load PDF library on page load - only when needed
        // This prevents mobile freezing issues

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function formatTime(date) {
            return new Date(date).toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Export data for debugging
        function exportFormData() {
            console.log('Current Form Data:', JSON.stringify(formData, null, 2));
            return formData;
        }

        // Console helper
        // Add event listeners for Page 2 fields to save data
        function initializePage2Listeners() {
            const fields = ['bu', 'region', 'clusterZone', 'ibc', 'deptSection', 'subDept', 'mtlNo', 'jobLocation', 'workDetails'];
            
            fields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.addEventListener('input', function() {
                        formData[fieldId] = this.value;
                        saveFormData();
                        clearError(fieldId);
                    });
                }
            });
            
            // PTW No listener
            const ptwNoEl = document.getElementById('ptwNo');
            if (ptwNoEl) {
                ptwNoEl.addEventListener('input', function() {
                    formData.ptwNo = this.value;
                    saveFormData();
                });
            }
            
            // LOTO No listener
            const lotoNoEl = document.getElementById('lotoNo');
            if (lotoNoEl) {
                lotoNoEl.addEventListener('input', function() {
                    formData.lotoNo = this.value;
                    saveFormData();
                });
            }
            
            // Save date and time from display elements
            function saveDateTimeToFormData() {
                const dateEl = document.getElementById('date');
                const timeEl = document.getElementById('time');
                if (dateEl && dateEl.textContent) {
                    formData.date = dateEl.textContent;
                }
                if (timeEl && timeEl.textContent) {
                    formData.time = timeEl.textContent;
                }
                saveFormData();
            }
            
            // Initial save and repeat every 2 seconds
            saveDateTimeToFormData();
            setInterval(saveDateTimeToFormData, 2000);
        }
        
        // Initialize listeners when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage2Listeners);
        } else {
            setTimeout(initializePage2Listeners, 100);
        }

        console.log('%cTRIC Form App Ready! ', 'color: #10B981; font-size: 16px; font-weight: bold;');
        console.log('Use exportFormData() to view current data');
    </script>

    <!-- PWA Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Auto-detect correct path for service worker
                // Works on GitHub Pages (subdirectory) AND root hosting (Netlify, AWS, etc.)
                const swPath = document.querySelector('script[src*="sw"]') 
                    ? 'sw.js'  // If we can find it relatively
                    : (window.location.pathname.split('/').length > 2 ? './sw.js' : '/sw.js');
                
                // Simple detection: if URL has more than one path segment, use relative
                const isGitHubPages = window.location.hostname.includes('github.io') && 
                                     window.location.pathname !== '/' && 
                                     window.location.pathname !== '/index.html';
                
                const finalPath = isGitHubPages ? './sw.js' : '/sw.js';
                
                console.log('[PWA] Registering Service Worker at:', finalPath);
                
                navigator.serviceWorker.register(finalPath)
                    .then(registration => {
                        console.log(' Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('New Service Worker found, installing...');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('New version available! Please refresh.');
                                    // Optionally show a notification to user
                                    if (confirm('New version available! Would you like to update?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });

            // Handle service worker updates
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    window.location.reload();
                    refreshing = true;
                }
            });
        } else {
            console.log('Service Worker is not supported in this browser.');
        }

        // Install prompt for PWA
        let deferredPrompt;
        let installButton = null;

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA install prompt available');
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show install button (you can customize this)
            showInstallPrompt();
        });

        function showInstallPrompt() {
            // Create install button if it doesn't exist
            if (!installButton && document.getElementById('page1')) {
                installButton = document.createElement('button');
                installButton.innerHTML = `
                    <svg style="width: 20px; height: 20px; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Install App
                `;
                installButton.style.cssText = `
                    width: 100%;
                    padding: 14px;
                    background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-top: 12px;
                    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
                    transition: all 0.2s;
                `;
                
                installButton.addEventListener('mouseover', () => {
                    installButton.style.transform = 'translateY(-2px)';
                    installButton.style.boxShadow = '0 6px 16px rgba(59, 130, 246, 0.4)';
                });
                
                installButton.addEventListener('mouseout', () => {
                    installButton.style.transform = 'translateY(0)';
                    installButton.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.3)';
                });
                
                installButton.onclick = installPWA;
                
                // Insert after the Start Form button
                const contentDiv = document.querySelector('#page1 .content');
                if (contentDiv) {
                    contentDiv.appendChild(installButton);
                }
            }
        }

        async function installPWA() {
            if (!deferredPrompt) {
                console.log('Install prompt not available');
                return;
            }
            
            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            
            console.log(`User response to install prompt: ${outcome}`);
            
            if (outcome === 'accepted') {
                console.log('User accepted the install prompt');
                // Hide the install button
                if (installButton) {
                    installButton.style.display = 'none';
                }
            } else {
                console.log('User dismissed the install prompt');
            }
            
            // Clear the deferred prompt
            deferredPrompt = null;
        }

        // Detect if app is installed
        window.addEventListener('appinstalled', (evt) => {
            console.log('TRIC Form PWA was installed successfully!');
            // Hide install button if visible
            if (installButton) {
                installButton.style.display = 'none';
            }
        });

        // Check if running as installed PWA
        function isRunningStandalone() {
            return (window.matchMedia('(display-mode: standalone)').matches) || 
                   (window.navigator.standalone) || 
                   document.referrer.includes('android-app://');
        }

        if (isRunningStandalone()) {
            console.log('Running as installed PWA');
            // You can add special features for installed app here
        }
    </script>
</body>
</html>
